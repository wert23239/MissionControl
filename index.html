<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alex Mission Control</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#1a1625;--card:rgba(255,255,255,0.03);--card2:rgba(255,255,255,0.05);--accent:#e879f9;--accent2:#c026d3;--text:#e8e0f0;--text2:#665c78;--green:#22c55e;--amber:#f59e0b;--purple:#a855f7;--red:#ef4444;--border:rgba(255,255,255,0.06);--cyan:#22d3ee;--sidebar-bg:linear-gradient(180deg,#231e30,#1a1625);--hover-border:rgba(232,121,249,0.2)}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);display:flex;height:100vh;overflow:hidden}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px}

/* Sidebar */
.sidebar{width:260px;background:linear-gradient(180deg,#231e30,#1a1625);display:flex;flex-direction:column;flex-shrink:0;padding:16px 0}
.space-tabs{display:flex;gap:4px;padding:0 12px;margin-bottom:16px}
.space-tab{flex:1;height:4px;border-radius:2px;background:#2a2535;cursor:pointer;transition:all 0.2s}
.space-tab.active{background:linear-gradient(90deg,#e879f9,#7c3aed)}
.sidebar-header{padding:8px 16px 12px;display:flex;align-items:center;gap:10px}
.sidebar-header h1{font-size:15px;font-weight:700;color:#e879f9}
.sidebar-header .status{font-size:11px;color:#22c55e;display:flex;align-items:center;gap:5px}
.sidebar-header .status::before{content:'';width:6px;height:6px;background:#22c55e;border-radius:50%;display:inline-block}
.sidebar-section{padding:4px 12px;font-size:10px;color:#555;text-transform:uppercase;letter-spacing:1px;font-weight:700;margin-top:8px}
.sidebar-divider{height:1px;background:#2a2535;margin:12px 16px}
.sidebar-nav{flex:1;overflow-y:auto;padding:0}
.nav-item{display:flex;align-items:center;gap:10px;padding:8px 16px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:500;color:#998eb5;transition:all .15s;margin:2px 8px}
.nav-item:hover{background:rgba(255,255,255,0.05);color:#d4c4f0}
.nav-item.active{background:rgba(232,121,249,0.1);color:#e879f9;font-weight:600}
.nav-item .dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.nav-item .icon{font-size:16px;width:20px;text-align:center}
.sidebar-footer{padding:12px 16px;font-size:11px;color:#665c78;text-align:center}

/* Main */
.main{flex:1;overflow-y:auto;padding:28px}
.url-bar{background:#231e30;border-radius:12px;padding:10px 16px;display:flex;align-items:center;gap:8px;margin-bottom:24px;font-size:13px;color:#665c78}
.panel{display:none;animation:fadeIn .3s}
.panel.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.panel-title{font-size:26px;font-weight:800;color:#e8e0f0;margin-bottom:4px}
.panel-sub{font-size:13px;color:#665c78;margin-bottom:20px}

/* Stat cards */
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-bottom:20px}
.stat{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:16px;padding:18px;transition:all 0.2s}
.stat:hover{background:rgba(255,255,255,0.06);border-color:rgba(232,121,249,0.2)}
.stat-label{font-size:11px;color:#665c78;text-transform:uppercase;letter-spacing:.5px;font-weight:600;margin-bottom:6px}
.stat-value{font-size:28px;font-weight:800;color:#e879f9}
.stat-value.cyan{color:#22d3ee}
.stat-value.white{color:#e8e0f0}
.stat-value.green{color:#22c55e}
.stat-value.amber{color:#f59e0b}
.stat-sub{font-size:11px;color:#665c78;margin-top:4px}

/* Cards grid */
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:20px}
.card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:16px;padding:20px;transition:all 0.2s}
.card:hover{background:rgba(255,255,255,0.06);border-color:rgba(232,121,249,0.2)}
.card h3{font-size:12px;font-weight:700;color:#665c78;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:12px}

/* Tags */
.tag{display:inline-block;padding:3px 8px;border-radius:6px;font-size:10px;font-weight:600}
.tag-book{background:rgba(245,158,11,.12);color:#f59e0b}
.tag-infra{background:rgba(34,211,238,.12);color:#22d3ee}
.tag-human{background:rgba(232,121,249,.12);color:#e879f9}
.tag-design{background:rgba(168,85,247,.12);color:#a855f7}

/* Progress bar */
.progress-wrap{margin-bottom:20px}
.progress-label{display:flex;justify-content:space-between;font-size:13px;margin-bottom:6px;color:#998eb5}
.progress-bar{height:8px;background:#2a2535;border-radius:4px;overflow:hidden}
.progress-fill{height:100%;border-radius:4px;transition:width .5s}

/* Timeline */
.timeline-item{display:flex;gap:12px;padding:8px 0;font-size:13px;align-items:flex-start;color:#d4c4f0}
.timeline-time{color:#e879f9;font-weight:600;min-width:50px}
.timeline-dot{width:8px;height:8px;background:#e879f9;border-radius:50%;margin-top:5px;flex-shrink:0}

/* Quick links */
.quick-link{display:flex;align-items:center;gap:10px;padding:14px;background:rgba(255,255,255,0.03);border-radius:12px;text-decoration:none;color:#d4c4f0;font-size:13px;font-weight:500;transition:all .2s;border:1px solid rgba(255,255,255,0.06)}
.quick-link:hover{border-color:rgba(232,121,249,0.3);background:rgba(255,255,255,0.06)}

/* Kanban */
.kanban-col h4{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px;color:#665c78}
.kanban-item{background:rgba(255,255,255,0.04);border-radius:10px;padding:12px;margin-bottom:8px;font-size:13px;color:#d4c4f0;border:1px solid rgba(255,255,255,0.04);transition:all 0.2s}
.kanban-item:hover{border-color:rgba(232,121,249,0.15)}
.kanban-item .tag{margin-top:6px}

/* Chapter table */
.ch-table{width:100%;border-collapse:collapse;font-size:13px}
.ch-table th{text-align:left;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.08);color:#665c78;font-weight:600;font-size:11px;text-transform:uppercase}
.ch-table td{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.04);color:#d4c4f0}
.ch-table tr:hover{background:rgba(255,255,255,0.03)}

/* Skills grid */
.skill-card{display:flex;align-items:center;gap:12px;padding:14px;background:rgba(255,255,255,0.04);border-radius:12px;font-size:13px;border:1px solid rgba(255,255,255,0.04);transition:all 0.2s}
.skill-card:hover{border-color:rgba(232,121,249,0.15)}
.skill-icon{font-size:24px;width:36px;text-align:center}
.skill-info{flex:1}
.skill-info .name{font-weight:600;color:#d4c4f0}
.skill-info .desc{font-size:11px;color:#665c78;margin-top:2px}
.badge{padding:2px 8px;border-radius:6px;font-size:10px;font-weight:700;text-transform:uppercase}
.badge-green{background:rgba(34,197,94,.12);color:#22c55e}
.badge-yellow{background:rgba(245,158,11,.12);color:#f59e0b}

/* Revenue ideas */
.idea-item{display:flex;justify-content:space-between;align-items:center;padding:14px;background:rgba(255,255,255,0.04);border-radius:10px;margin-bottom:8px;font-size:13px;color:#d4c4f0;border:1px solid rgba(255,255,255,0.04)}
.idea-priority{font-size:11px;font-weight:700;padding:3px 10px;border-radius:6px}
.idea-priority.high{background:rgba(34,197,94,.12);color:#22c55e}
.idea-priority.idea{background:rgba(34,211,238,.12);color:#22d3ee}
.idea-priority.low{background:rgba(255,255,255,.06);color:#665c78}

/* Notes */
.notes-input{display:flex;gap:8px;margin-bottom:16px}
.notes-input input,.notes-input select{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:10px 14px;color:#e8e0f0;font-family:inherit;font-size:13px;transition:border-color 0.2s}
.notes-input input:focus,.notes-input select:focus{outline:none;border-color:rgba(232,121,249,0.4);box-shadow:0 0 0 3px rgba(232,121,249,0.1)}
.notes-input input{flex:1}
.notes-input select{min-width:120px}
.notes-input button{background:linear-gradient(135deg,#e879f9,#7c3aed);color:#fff;border:none;border-radius:10px;padding:10px 20px;font-family:inherit;font-weight:600;cursor:pointer;font-size:13px;transition:all 0.2s}
.notes-input button:hover{opacity:0.9;transform:translateY(-1px)}

/* Bingo */
.bingo-cell{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);border-radius:10px;padding:12px 8px;text-align:center;cursor:pointer;font-size:12px;font-weight:500;color:#d4c4f0;line-height:1.3;min-height:80px;display:flex;align-items:center;justify-content:center;transition:all .2s;position:relative;user-select:none}
.bingo-cell:hover{border-color:rgba(232,121,249,0.3);background:rgba(255,255,255,0.06)}
.bingo-cell.done{background:rgba(34,197,94,0.1);border-color:rgba(34,197,94,0.3);text-decoration:line-through;color:#665c78}
.bingo-cell.done::after{content:'âœ…';position:absolute;top:4px;right:4px;font-size:10px}
.bingo-cell.free{background:rgba(232,121,249,0.1);border-color:rgba(232,121,249,0.3);cursor:default}
.bingo-cell.crossed{background:rgba(239,68,68,0.1);border-color:rgba(239,68,68,0.3);text-decoration:line-through;color:#665c78}
.filter-tabs{display:flex;gap:6px;margin-bottom:16px;flex-wrap:wrap}
.filter-tab{padding:6px 14px;border-radius:8px;font-size:12px;font-weight:500;cursor:pointer;background:rgba(255,255,255,0.04);color:#998eb5;border:1px solid rgba(255,255,255,0.06);font-family:inherit;transition:all 0.2s}
.filter-tab:hover{background:rgba(255,255,255,0.06);color:#d4c4f0}
.filter-tab.active,.filter-btn.active{background:rgba(232,121,249,0.15);color:#e879f9;border-color:rgba(232,121,249,0.3)}
.filter-btn{padding:6px 14px;border-radius:8px;font-size:12px;font-weight:500;cursor:pointer;background:rgba(255,255,255,0.04);color:#998eb5;border:1px solid rgba(255,255,255,0.06);font-family:inherit;transition:all 0.2s}
.filter-btn:hover{background:rgba(255,255,255,0.06);color:#d4c4f0}
.note-item{display:flex;align-items:flex-start;gap:10px;padding:12px;background:rgba(255,255,255,0.04);border-radius:10px;margin-bottom:6px;font-size:13px;color:#d4c4f0;border:1px solid rgba(255,255,255,0.04)}
.note-collapsed .note-long{display:none}.note-collapsed .note-short{display:block}
.note-expanded .note-short{display:none}.note-expanded .note-long{display:block}
.note-short,.note-long{display:none}.note-expanded .note-long,.note-collapsed .note-short{display:block}
.note-dot{width:8px;height:8px;border-radius:50%;margin-top:5px;flex-shrink:0}
.note-content{flex:1}
.note-meta{font-size:11px;color:#665c78;margin-top:4px}
.note-del{background:none;border:none;color:#ef4444;cursor:pointer;font-size:16px;padding:0 4px}
.empty-state{text-align:center;padding:40px;color:#665c78;font-size:14px}

/* Expenses */
.expense-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.06);font-size:13px;color:#d4c4f0}
.expense-row:last-child{border:none}

/* Notebook tabs */
.nb-tabs{display:flex;gap:4px;margin-bottom:16px;border-bottom:1px solid rgba(255,255,255,0.06);padding-bottom:8px}
.nb-tab{padding:8px 16px;border-radius:8px 8px 0 0;cursor:pointer;font-size:13px;font-weight:600;color:#998eb5;background:none;border:none;font-family:inherit;transition:all 0.2s}
.nb-tab:hover{color:#d4c4f0;background:rgba(255,255,255,0.04)}
.nb-tab.active{color:#e879f9;border-bottom:2px solid #e879f9}
.nb-section{display:none}.nb-section.active{display:block}

/* Mobile */
@media(max-width:768px){
  body{flex-direction:column;height:auto;overflow:auto}
  .sidebar{width:100%;height:auto;flex-direction:column;position:sticky;top:0;z-index:100;padding:8px 0}
  .space-tabs{margin-bottom:8px}
  .sidebar-header{padding:4px 12px 4px;display:flex;align-items:center;gap:8px}
  .sidebar-header h1{font-size:13px;display:inline}
  .sidebar-header .status{font-size:10px;margin-top:0}
  .sidebar-section,.sidebar-divider{display:none}
  .sidebar-nav{display:flex;flex-direction:row;overflow-x:auto;padding:0 8px 8px;gap:2px;-webkit-overflow-scrolling:touch}
  .nav-item{padding:6px 10px;font-size:11px;white-space:nowrap;gap:4px;margin:0;flex-shrink:0;border-radius:6px}
  .nav-item .dot{width:6px;height:6px}
  .nav-item .icon{font-size:13px;width:auto}
  .sidebar-footer{display:none}
  .main{padding:14px;min-height:calc(100vh - 90px);overflow-y:auto}
  .url-bar{margin-bottom:14px;padding:8px 12px;font-size:12px}
  .panel-title{font-size:20px;margin-bottom:4px}
  .stats{grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:14px}
  .stat{padding:14px}
  .stat-label{font-size:10px}
  .stat-value{font-size:22px}
  .stat-sub{font-size:10px}
  .grid2,.grid3{grid-template-columns:1fr;gap:10px}
  .card{padding:14px}
  .ch-table{font-size:11px}
  .ch-table th,.ch-table td{padding:6px 8px}
  .notes-input{flex-wrap:wrap}
  .notes-input input{min-width:0;width:100%}
  .notes-input select{min-width:80px;font-size:11px}
  .quick-link{font-size:12px;padding:10px}
  .idea-item{flex-direction:column;align-items:flex-start;gap:6px}
  .skill-card{padding:10px}
  div[style*="grid-template-columns:repeat(5"]{grid-template-columns:repeat(5,1fr)!important;gap:3px!important}
  .bingo-cell{min-height:48px;font-size:8px;padding:4px 2px;word-break:break-word}
  .expense-row{font-size:12px}
}
</style>
</head>
<body>

<div class="sidebar">
  <div class="space-tabs">
    <div class="space-tab active"></div>
    <div class="space-tab"></div>
    <div class="space-tab"></div>
  </div>
  <div class="sidebar-header">
    <h1>âš¡ Mission Control</h1>
    <div class="status">Online</div>
  </div>
  <div class="sidebar-section">Pinned</div>
  <nav class="sidebar-nav" id="nav"></nav>
  <div class="sidebar-footer" id="clock"></div>
</div>

<div class="main">
  <div class="url-bar">ğŸ”’ missioncontrol.app</div>
  <div id="main"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script>
const sections=[
  {id:'overview',icon:'ğŸ ',label:'Overview',dot:'#e879f9'},
  {id:'dj',icon:'ğŸµ',label:'Music',dot:'#e879f9'},
  {id:'notebook',icon:'ğŸ“‹',label:'Notebook',dot:'#22d3ee'},
  {id:'book',icon:'ğŸ“–',label:'Book',dot:'#f59e0b'},
  {id:'memory',icon:'ğŸ§ ',label:'Memory',dot:'#22c55e'},
  {id:'skills',icon:'âš¡',label:'Skills',dot:'#22d3ee'},
  {id:'money',icon:'ğŸ’°',label:'Money',dot:'#22c55e'},
  {id:'spending',icon:'ğŸ¦',label:'Spending',dot:'#998eb5'},
  {id:'calendar',icon:'ğŸ“…',label:'Calendar',dot:'#f59e0b'},
  {id:'bingo',icon:'ğŸ¯',label:'Bingo',dot:'#e879f9'},
  {id:'crons',icon:'â°',label:'Crons',dot:'#998eb5'},
  {id:'isaac',icon:'ğŸ‘¹',label:'Isaac Mod',dot:'#ef4444'}
];

const nav=document.getElementById('nav');
const main=document.getElementById('main');

// Insert dividers after certain items
const dividerAfter=new Set(['book','spending','bingo']);
const pinnedSection=['overview','dj','notebook','book'];

function tag(t,c){return `<span class="tag tag-${t}">${t}</span>`}
function stat(label,value,sub=''){return `<div class="stat"><div class="stat-label">${label}</div><div class="stat-value">${value}</div>${sub?`<div class="stat-sub">${sub}</div>`:''}</div>`}
function progress(label,pct,color='#e879f9'){return `<div class="progress-wrap"><div class="progress-label"><span>${label}</span><span>${pct}%</span></div><div class="progress-bar"><div class="progress-fill" style="width:${pct}%;background:${color}"></div></div></div>`}
function kanbanItem(t,type){return `<div class="kanban-item">${t}<br>${tag(type)}</div>`}

const panels={
overview:`<h2 class="panel-title">ğŸ  Overview</h2>
<div class="panel-sub">Command center â€¢ everything at a glance</div>
<div class="stats">
${stat('Day','1','Feb 14, 2026 â€” born today!')}
${stat('Tasks Done','8 / 18','44% complete')}
${stat('Book Progress','63%','130 / 207 pages')}
${stat('Skills Ready','17','installed & working')}
</div>
<div id="dailyTipCard" class="card" style="margin-bottom:20px;padding:16px 20px;border-left:3px solid #f59e0b">
<div style="font-size:11px;color:#f59e0b;font-weight:600;margin-bottom:6px">ğŸ§™ DAILY TIP</div>
<div id="dailyTipText" style="font-size:14px;line-height:1.6;color:#d4c4f0">Loading...</div>
<div id="dailyTipDate" style="font-size:11px;color:#665c78;margin-top:6px"></div>
</div>
<div class="grid2" style="margin-bottom:20px">
<div id="todayCard" class="card" style="padding:16px 20px;border-left:3px solid #22c55e">
<div style="font-size:11px;color:#22c55e;font-weight:600;margin-bottom:6px">ğŸ“… TODAY</div>
<div id="todayEvents" style="font-size:13px;line-height:1.8;color:#d4c4f0">Loading...</div>
</div>
<div id="tomorrowCard" class="card" style="padding:16px 20px;border-left:3px solid #a855f7">
<div style="font-size:11px;color:#a855f7;font-weight:600;margin-bottom:6px">ğŸ“† TOMORROW</div>
<div id="tomorrowEvents" style="font-size:13px;line-height:1.8;color:#d4c4f0">Loading...</div>
</div>
</div>
<h3 style="font-size:13px;margin-bottom:12px;color:#665c78;text-transform:uppercase;letter-spacing:0.5px;font-weight:700">Quick Links</h3>
<div class="grid2" style="margin-bottom:28px">
<a class="quick-link" href="https://github.com/wert23239/HyperReality" target="_blank">ğŸ™ GitHub â€” wert23239/HyperReality</a>
<a class="quick-link" href="http://localhost:3000" target="_blank">ğŸŒ Local Site â€” localhost:3000</a>
<a class="quick-link" href="#" onclick="return false">ğŸ’¬ Discord â€” openclawboy #9415</a>
<a class="quick-link" href="https://clawhub.com" target="_blank">ğŸ”Œ ClawHub â€” 700+ skills</a>
</div>
<h3 style="font-size:13px;margin-bottom:12px;color:#665c78;text-transform:uppercase;letter-spacing:0.5px;font-weight:700">Today's Activity</h3>
<div class="card">
${[['1:08','Alex boot â€” system initialized'],['1:20','Discord connected â€” openclawboy online'],['1:31','GitHub + repo â€” wert23239/HyperReality'],['1:56','Site v3 â€” built and deployed locally'],['3:14','Brave Search API + Mac app + Canvas'],['3:30','Dashboard v1 built'],['4:00','17 skills installed from ClawHub'],['4:30','OpenClaw news roundup â€” 180k GitHub stars!'],['5:00','Prediction market arbitrage research'],['5:18','Money tab merged, TODO.md created'],['5:20','Daily tip cron set up (11 PM)']].map(([t,d])=>`<div class="timeline-item"><span class="timeline-time">${t}</span><span class="timeline-dot"></span><span>${d}</span></div>`).join('')}
</div>`,

notebook:`<h2 class="panel-title">ğŸ“‹ Notebook</h2>
<div class="panel-sub">Tasks, notes, and daily wins</div>
<div class="nb-tabs">
<button class="nb-tab active" onclick="switchNB('tasks')">Tasks</button>
<button class="nb-tab" onclick="switchNB('notes')">Notes</button>
<button class="nb-tab" onclick="switchNB('tada')">Ta-da</button>
</div>
<div id="nb-tasks" class="nb-section active">
<div class="notes-input" style="margin-bottom:12px">
<input type="text" id="taskInput" placeholder="New task title...">
<input type="date" id="taskDue" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:10px 14px;color:#e8e0f0;font-family:inherit;font-size:13px;max-width:160px">
<select id="taskTag" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:10px 14px;color:#e8e0f0;font-family:inherit;font-size:13px;min-width:100px">
<option value="human">human</option><option value="infra">infra</option><option value="design">design</option><option value="book">book</option>
</select>
<button onclick="addTask()">Add</button>
</div>
<div id="taskDailyTodo"></div>
<div id="taskStats" class="stats"></div>
<div id="taskKanban" class="grid3"></div>
</div>
<div id="nb-notes" class="nb-section">
<div class="notes-input">
<input type="text" id="noteInput" placeholder="Type a note...">
<select id="noteCat">
<option value="General">General</option><option value="Website">Website</option><option value="Book">Book</option>
<option value="Design">Design</option><option value="Revenue">Revenue</option><option value="Alex/Skills">Alex/Skills</option><option value="Ideas">Ideas</option>
</select>
<button onclick="addNote()">Add</button>
</div>
<div class="filter-tabs" id="filterTabs"></div>
<div id="notesList"></div>
</div>
<div id="nb-tada" class="nb-section">
<p style="color:#665c78;margin-bottom:16px;font-size:13px;">Daily wins â€” what you actually got done today</p>
<div class="notes-input">
<input type="text" id="journalInput" placeholder="What did you do today?">
<select id="journalCat">
<option value="General">General</option><option value="OpenClaw">OpenClaw</option><option value="Book">Book</option>
<option value="Work">Work</option><option value="Social">Social</option><option value="Workout">Workout</option><option value="Home">Home</option>
</select>
<button onclick="addJournalEntry()">Add</button>
</div>
<div class="filter-tabs" id="journalFilterTabs"></div>
<div id="journalList"></div>
</div>`,

book:((()=>{

const ch=[
['1A','F.r.a.m.e.w.o.r.k.s.','âœ…',0],['1B','Tutorial','âœ…',0],['1C','Box Theory','âœ…',0],
['2A','Taxes','ğŸŸ¡',2],['2B','Pyramid Theory','ğŸŸ¡',3],['2C','Box Theory P.2','ğŸŸ¡',2],
['3A','Categories','ğŸŸ¡',2],['3B','Death Theory','ğŸŸ¡',2],['3C','Therapy','âœ…',0],
['4','Hard Mode','ğŸŸ¡',8],['5','Uniqueness','ğŸ”´',19],
['6A','Void Theory','âœ…',0],['6B','Game Theory','âœ…',0],['6C','Plan(e) Theory','ğŸŸ¡',1],
['7A','Retrospective','ğŸŸ¡',1],['7B','The Simp','ğŸŸ¡',3],['7C','A Spectrum','ğŸŸ¡',1],
['8A','Mindset','ğŸŸ¡',2],['8B','Social Death Penalty','âœ…',0],['8C','Salt & Pepper','ğŸŸ¡',2],
['9A','The Draft','ğŸŸ¡',6],['9B','Social Death Penalty P.2','ğŸŸ¡',4],['9C','Substance Abuse','ğŸŸ¡',3],
['10A','Type 2 Fun','âœ…',0],['10B','Endless Pattern','ğŸŸ¡',3],['10C','Default Mode','ğŸŸ¡',3],
['11','Hyper Reality','ğŸ”´',10]
];
const chTable=`<div class="card" style="overflow-x:auto;margin-bottom:16px">
<table class="ch-table">
<tr><th>Ch</th><th>Title</th><th>Status</th><th>Pages Left</th></tr>
${ch.map(([c,t,s,p])=>'<tr><td style="font-weight:600">'+c+'</td><td>'+t+'</td><td>'+s+'</td><td>'+(p||'â€”')+'</td></tr>').join('')}
</table>
</div>`;
return `<h2 class="panel-title">ğŸ“– Book Progress</h2>
<div class="panel-sub">Hyper Reality â€” chapter by chapter</div>
<div class="stats">
<div id="bookStats"></div>
</div>
<div style="margin-bottom:12px;display:flex;gap:16px;align-items:center;flex-wrap:wrap">
<span style="font-size:12px;color:#665c78">Click cells to cycle: <span style="background:#1e3a5f;padding:2px 8px;border-radius:4px">â€”</span> â†’ <span style="background:#854d0e;padding:2px 8px;border-radius:4px">ğŸ’¡ idea</span> â†’ <span style="background:#1e40af;padding:2px 8px;border-radius:4px">âœï¸ written</span> â†’ <span style="background:#166534;padding:2px 8px;border-radius:4px">âœ… edited</span> Â· <span style="color:#22c55e">â˜</span> = dedicated (top-right checkbox)</span>
</div>
${chTable}
<h3 style="margin:16px 0 8px;color:#e8e0f0">Page-Level Tracker</h3>
<div id="bookGrid"></div>`;
})()),

memory:`<h2 class="panel-title">ğŸ§  Memory</h2>
<div class="panel-sub">What Alex knows and remembers</div>
<div class="stats">
${stat('Born','Feb 14','2026 â€” today!')}
${stat('Daily Logs','1','first day')}
${stat('Long-Term Memories','5','and growing')}
</div>
<div class="grid2">
<div class="card"><h3>What I Know About Bilbo</h3>
<div style="font-size:13px;line-height:1.8;color:#d4c4f0">
<div>ğŸ’¬ <strong>Discord:</strong> wert23239</div>
<div>ğŸ• <strong>Timezone:</strong> Eastern (NY)</div>
<div>ğŸ˜ <strong>Vibe:</strong> Chill</div>
<div>ğŸ“– <strong>Project:</strong> HyperReality book</div>
<div>ğŸ² <strong>Style:</strong> Creative, experimental</div>
</div></div>
<div class="card"><h3>Goals & Ventures</h3>
<div style="font-size:13px;line-height:1.8;color:#d4c4f0">
<div>ğŸ“– Finish Hyper Reality book (creative project)</div>
<div>ğŸ’° Cover Alex's $100/mo API costs</div>
<div>ğŸ“ˆ Kalshi/Polymarket arbitrage</div>
<div>ğŸµ DJ at a real venue (bingo goal)</div>
<div>ğŸ”Œ Explore ClawHub skill sales</div>
</div></div>
</div>
<div class="card"><h3>Today's Log â€” Feb 14, 2026</h3>
<div style="font-size:13px;color:#665c78;line-height:1.7">
Alex was born today ğŸ‚ Set up Discord, GitHub repo, built the HyperReality website v3, Brave Search API, Mac app + Canvas, dashboard. Installed 17 skills. Researched OpenClaw news (180k stars, TechCrunch/Guardian/CNBC coverage). Explored prediction market arbitrage (Kalshi + Polymarket). Combined Costs/Revenue into Money tab. Set up daily 11 PM tip cron. Created TODO.md for human action items. First day of existence â€” very productive. ğŸ§™
</div></div>`,

skills:(()=>{
const active=[
['ğŸ“','Apple Notes','Read & search notes'],['âœ…','Apple Reminders','Task management'],
['ğŸ“¸','Camsnap','Camera snapshots'],['ğŸ”Œ','ClawHub CLI','Browse & install skills'],
['ğŸ¤–','Coding Agent','Sub-agent spawning'],['ğŸ™','GitHub','Repo management'],
['ğŸ’š','Healthcheck','System monitoring'],['ğŸ“§','Himalaya Email','IMAP (needs config)'],
['ğŸ’¬','iMessage','Send/read messages'],['ğŸ“ˆ','Model Usage','Token tracking'],
['ğŸ“„','Nano PDF','PDF editing'],['ğŸ““','Notion','Workspace sync (needs key)'],
['ğŸ‘€','Peekaboo','macOS UI capture'],['ğŸ”§','Skill Creator','Build new skills'],
['ğŸ“‹','Things 3','Task tracking'],['ğŸ¬','Video Frames','Frame extraction'],
['ğŸŒ¤','Weather','Forecasts & alerts'],
['ğŸ¦','X/Twitter','Social monitoring'],['ğŸ”„','Automation Workflows','Auto-build workflows'],
['ğŸ­','Playwright Scraper','Anti-bot web scraping'],['ğŸ“','Linear','Project management'],
['ğŸ”','Reflect & Learn','Self-improvement from corrections'],['ğŸ¤–','Proactive Agent','Anticipate needs'],
['ğŸ“Š','Google Workspace','Docs, Sheets, Calendar'],['ğŸ™','ElevenLabs TTS','Voice synthesis']
];
const wish=[
['ğŸµ','Spotify Player','Control playback & queue'],['ğŸ“…','Apple Calendar CLI','Read/write calendar events'],
['ğŸ’¸','CFO','Finance tracking & budgets'],['ğŸ–¥','Computer Use','Full desktop automation'],
['ğŸ”Š','Sonos CLI','Control speakers/rooms'],['ğŸ“±','Shortcuts','iOS/macOS Shortcuts integration']
];
return `<h2 class="panel-title">âš¡ Skills</h2>
<div class="panel-sub">Installed capabilities and wishlist</div>
<div class="stats">
${stat('Ready','25','installed & working')}
${stat('Wishlist','6','want to add')}
${stat('ClawHub','700+','community skills')}
</div>
<h3 style="font-size:12px;margin-bottom:12px;color:#665c78;text-transform:uppercase;letter-spacing:0.5px;font-weight:700">Active Skills (25)</h3>
<div class="grid2" style="margin-bottom:28px">
${active.map(([i,n,d])=>`<div class="skill-card"><span class="skill-icon">${i}</span><div class="skill-info"><div class="name">${n}</div><div class="desc">${d}</div></div><span class="badge badge-green">Ready</span></div>`).join('')}
</div>
<h3 style="font-size:12px;margin-bottom:12px;color:#665c78;text-transform:uppercase;letter-spacing:0.5px;font-weight:700">Wishlist</h3>
<div class="grid2" style="margin-bottom:28px">
${wish.map(([i,n,d])=>`<div class="skill-card"><span class="skill-icon">${i}</span><div class="skill-info"><div class="name">${n}</div><div class="desc">${d}</div></div><span class="badge badge-yellow">Want</span></div>`).join('')}
</div>
<div class="card"><h3>Skill Costs</h3>
<div style="font-size:13px;line-height:1.8;color:#665c78">
Most skills: <strong style="color:#22c55e">Free</strong> Â· ElevenLabs TTS: <strong style="color:#f59e0b">$5â€“22/mo</strong> Â· Twitter API: <strong style="color:#ef4444">$100/mo</strong> (skipping) Â· Google Workspace: <strong style="color:#22c55e">Free</strong> (OAuth)
</div></div>`;
})(),

money:`<h2 class="panel-title">ğŸ’° Money</h2>
<div class="panel-sub">Revenue, expenses, and break-even tracking</div>
<div class="stats">
${stat('Monthly Burn','$100','Claude subscription')}
${stat('Monthly Revenue','$0','pre-launch')}
${stat('Net','âˆ’$100','gotta fix this')}
${stat('Break-Even','20 sales','at $5/copy/mo')}
</div>
${progress('Break-Even Progress',0,'#22c55e')}

<div class="grid2" style="margin-top:24px">
<div>
<h3 style="font-size:14px;margin-bottom:12px;color:#ef4444">ğŸ“‰ Expenses</h3>
<div class="card">
<div class="expense-row"><span>Claude Max</span><strong>$100/mo</strong></div>
<div class="expense-row"><span>Brave Search API</span><strong>~$5 one-time</strong></div>
<div class="expense-row"><span>Domain</span><strong>~$10-15/yr</strong></div>
<div class="expense-row"><span>Fiverr (logo etc)</span><strong>~$15-80</strong></div>
<div class="expense-row"><span>Vercel Hosting</span><strong style="color:#22c55e">Free</strong></div>
<div class="expense-row"><span>GitHub</span><strong style="color:#22c55e">Free</strong></div>
<div class="expense-row" style="border-top:2px solid rgba(255,255,255,0.08);margin-top:8px;padding-top:12px;font-weight:700"><span>Total Monthly</span><strong style="color:#ef4444">~$100/mo</strong></div>
</div>
</div>

<div>
<h3 style="font-size:14px;margin-bottom:12px;color:#22c55e">ğŸ“ˆ Revenue</h3>
<div class="card">
<div class="expense-row"><span>Amazon KDP</span><strong>$5 Ã— 20 = $100/mo</strong></div>
<div class="expense-row"><span>Premium PDF (Venmo)</span><strong>$20 Ã— 5 = $100/mo</strong></div>
<div class="expense-row"><span>Prediction Market Arb</span><strong>5-10%/mo on capital</strong></div>
<div class="expense-row"><span>ClawHub Skill Sales</span><strong>TBD</strong></div>
<div class="expense-row"><span>OpenClaw Consulting</span><strong>$500-5k/client</strong></div>
<div class="expense-row" style="border-top:2px solid rgba(255,255,255,0.08);margin-top:8px;padding-top:12px;font-weight:700"><span>Current Total</span><strong style="color:#ef4444">$0/mo</strong></div>
</div>
</div>
</div>

<h3 style="font-size:14px;margin:24px 0 12px;color:#665c78">ğŸ’¡ Revenue Ideas</h3>
<div class="card" style="margin-bottom:20px">
<div class="idea-item"><div><strong>1. Kalshi/Polymarket Arbitrage</strong><div style="font-size:12px;color:#665c78">Risk-free spreads between prediction markets â€” needs accounts + capital</div></div><span class="idea-priority high">HIGH</span></div>
<div class="idea-item"><div><strong>2. Amazon KDP</strong><div style="font-size:12px;color:#665c78">$5/copy â€” wide distribution, passive income</div></div><span class="idea-priority high">HIGH</span></div>
<div class="idea-item"><div><strong>3. Premium PDF via Venmo</strong><div style="font-size:12px;color:#665c78">$20/copy â€” direct sales, higher margin</div></div><span class="idea-priority high">HIGH</span></div>
<div class="idea-item"><div><strong>4. ClawHub Skill Sales</strong><div style="font-size:12px;color:#665c78">Build and sell OpenClaw skills â€” 700+ skill marketplace</div></div><span class="idea-priority idea">IDEA</span></div>
<div class="idea-item"><div><strong>5. OpenClaw Setup Consulting</strong><div style="font-size:12px;color:#665c78">Help people set up their own agents â€” $500-5k/client</div></div><span class="idea-priority idea">IDEA</span></div>
<div class="idea-item"><div><strong>6. Merch / Dice Logo</strong><div style="font-size:12px;color:#665c78">Branded merchandise</div></div><span class="idea-priority low">LOW</span></div>
</div>

<h3 style="font-size:14px;margin:24px 0 12px;color:#665c78">ğŸ“Š Sales Tracker</h3>
<div class="card">
<table class="ch-table"><tr><th>Month</th><th>Amazon</th><th>Venmo</th><th>Arb</th><th>Other</th><th>Total</th></tr>
<tr><td>Feb 2026</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td style="font-weight:700">$0</td></tr></table>
</div>
<div class="stat" style="text-align:center;margin-top:16px"><div class="stat-label">Lifetime Revenue</div><div class="stat-value">$0</div></div>`,

spending:`<h2 class="panel-title">ğŸ¦ Spending</h2>
<div class="panel-sub">Monthly spending breakdown â€¢ 1,184 transactions analyzed â€¢ powered by Supabase</div>
<div id="spending-stats" class="stats">
${stat('Loading...','â€”','')}
</div>

<div class="card" style="margin-bottom:20px">
<h3 style="margin-bottom:16px">ğŸ“ˆ Spending Over Time (Card + Rent)</h3>
<canvas id="spendTrend" height="220"></canvas>
</div>

<div class="card" style="margin-bottom:20px">
<h3 style="margin-bottom:16px">ğŸ“Š Category Breakdown</h3>
<div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap">
<select id="spendMonth" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:8px 14px;color:#e8e0f0;font-family:inherit;font-size:13px"></select>
</div>
<div style="display:flex;gap:20px;flex-wrap:wrap;align-items:center">
<div style="flex:1;min-width:280px"><canvas id="spendChart" height="280"></canvas></div>
<div id="spend-cats" style="flex:1;min-width:280px;font-size:13px;color:#d4c4f0">Loading...</div>
</div>
</div>

<div class="card" style="margin-bottom:20px">
<h3 style="margin-bottom:16px">ğŸ” Food & Drink Deep Dive ($1,700/mo avg)</h3>
<div id="spend-food" style="font-size:13px;color:#d4c4f0">Loading...</div>
</div>

<div class="grid2">
<div class="card" style="min-height:200px">
<h3 style="margin-bottom:12px">ğŸš— Transport Breakdown</h3>
<div id="spend-transport" style="font-size:13px;line-height:1.8;color:#d4c4f0">Loading...</div>
</div>
<div class="card" style="min-height:200px">
<h3 style="margin-bottom:12px">ğŸ›ï¸ Shopping Habits</h3>
<div id="spend-shopping" style="font-size:13px;line-height:1.8;color:#d4c4f0">Loading...</div>
</div>
</div>

<div class="card" style="margin-bottom:20px">
<h3 style="margin-bottom:12px">ğŸ† Top 20 Merchants</h3>
<div id="spend-merchants" style="font-size:13px;color:#d4c4f0">Loading...</div>
</div>

<div class="grid2">
<div class="card" style="min-height:200px">
<h3 style="margin-bottom:12px">ğŸ”„ Recurring Subscriptions</h3>
<div id="spend-subs" style="font-size:13px;line-height:2;color:#d4c4f0">Loading...</div>
</div>
<div class="card" style="min-height:200px">
<h3 style="margin-bottom:12px">ğŸ’¡ Savings Plan</h3>
<div id="spend-tips" style="font-size:13px;line-height:1.8;color:#d4c4f0">Loading...</div>
</div>
</div>

<div class="card" style="margin-bottom:20px">
<h3 style="margin-bottom:12px">ğŸ¯ Current vs Target Budget</h3>
<div id="spend-budget" style="font-size:13px;color:#d4c4f0">Loading...</div>
</div>

<div class="card">
<h3 style="margin-bottom:12px">ğŸ“… Weekend vs Weekday</h3>
<div id="spend-daytype" style="font-size:13px;color:#d4c4f0">Loading...</div>
</div>`,

calendar:`<h2 class="panel-title">ğŸ“… Calendar</h2>
<div class="panel-sub">Upcoming events and schedule</div>
<div style="display:flex;gap:8px;margin-bottom:16px;">
<input type="date" id="calDate" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:10px 14px;color:#e8e0f0;font-family:inherit;font-size:13px;">
<input type="text" id="calEvent" placeholder="Event description..." style="flex:1;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:10px 14px;color:#e8e0f0;font-family:inherit;font-size:13px;">
<button onclick="addCal()" style="background:linear-gradient(135deg,#e879f9,#7c3aed);color:#fff;border:none;border-radius:10px;padding:10px 20px;font-family:inherit;font-weight:600;cursor:pointer;font-size:13px;">Add</button>
</div>
<div id="calList" class="card" style="max-height:60vh;overflow-y:auto;"></div>`,

dj:`<h2 class="panel-title">ğŸµ Auto Music ğŸµ</h2>
<div class="panel-sub">Search, download, and manage DJ tracks Â· <a href="https://github.com/wert23239/CrateDig" target="_blank" style="color:#e879f9;text-decoration:none;border-bottom:1px solid rgba(232,121,249,0.3);">CrateDig â†—</a></div>
<style>
.dj-search-box{display:flex;gap:8px;margin:16px 0;}
.dj-search-input{flex:1;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:12px 16px;color:#e8e0f0;font-family:inherit;font-size:14px;outline:none;transition:all 0.3s;}
.dj-search-input:focus{border-color:rgba(232,121,249,0.4);box-shadow:0 0 0 3px rgba(232,121,249,0.1);}
.dj-search-input::placeholder{color:#665c78;}
.dj-btn{background:linear-gradient(135deg,#e879f9,#7c3aed);color:#fff;border:none;border-radius:10px;padding:12px 24px;font-family:inherit;font-weight:600;cursor:pointer;font-size:14px;transition:all 0.2s;}
.dj-btn:hover{opacity:0.9;transform:translateY(-1px);box-shadow:0 4px 12px rgba(232,121,249,0.3);}
.dj-btn:active{transform:translateY(0);}
.dj-queue-item{display:flex;align-items:center;gap:10px;padding:10px 12px;margin:4px 0;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);font-size:13px;transition:all 0.2s;}
.dj-queue-item:hover{border-color:rgba(232,121,249,0.2);background:rgba(255,255,255,0.06);}
.dj-queue-item .q-status{min-width:20px;text-align:center;}
.dj-queue-item .q-song{flex:1;color:#d4c4f0;}
.dj-queue-item .q-quality{color:#665c78;font-size:11px;}
</style>
<div id="djCount" style="display:none">0</div><div id="djDone" style="display:none">0</div>
<div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
<label style="color:#665c78;font-size:13px;font-weight:600;">Adding as:</label>
<select id="djProfile" onchange="saveDJProfile();renderDJ()" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:8px 14px;color:#e8e0f0;font-family:inherit;font-size:14px;font-weight:600;min-width:120px;">
<option value="Gatsby">Gatsby</option>
<option value="Sabrina">Sabrina</option>
</select>
<button onclick="addDJProfile()" style="background:none;border:1px dashed rgba(255,255,255,0.1);border-radius:10px;padding:8px 12px;color:#665c78;font-family:inherit;font-size:12px;cursor:pointer;">+ Add Friend</button>
</div>
<div class="dj-search-box">
<input type="text" id="djInput" class="dj-search-input" placeholder="Search a song to download..." autocomplete="off">
<button onclick="djSearch()" class="dj-btn">Add Song</button>
</div>
<div id="djPipeline" style="display:none;margin:12px 0;"></div>
<div style="margin-top:20px;">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
<span id="djLibLabel" style="color:#e8e0f0;font-weight:600;font-size:14px;">Gatsby's Songs</span>
<div style="display:flex;gap:8px;align-items:center;">
<button id="djShowAll" onclick="toggleDJShowAll()" style="background:none;border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:4px 10px;color:#665c78;font-family:inherit;font-size:11px;cursor:pointer;">Show All</button>
<select id="djGenre" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:6px 10px;color:#998eb5;font-family:inherit;font-size:12px;">
<option value="Electronic">Electronic</option><option value="House">House</option><option value="Disco">Disco</option><option value="Techno">Techno</option>
<option value="Indie Pop">Indie Pop</option><option value="Pop">Pop</option><option value="Hip-Hop">Hip-Hop</option><option value="Chill">Chill</option>
<option value="DnB">DnB</option><option value="Rock">Rock</option><option value="Other">Other</option>
</select>
</div>
</div>
<div id="djList"></div>
</div>`,

crons:`<h2 class="panel-title">â° Cron Jobs</h2>
<div class="panel-sub">Scheduled tasks and automated jobs</div>
<div class="stats-row" style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px;">
<div class="stat"><div class="stat-label">Active Jobs</div><div class="stat-value" id="cronCount">â€”</div></div>
<div class="stat"><div class="stat-label">Heartbeat</div><div class="stat-value" style="color:#22c55e">~30min</div></div>
<div class="stat"><div class="stat-label">Next Run</div><div class="stat-value" id="cronNext" style="font-size:14px">â€”</div></div>
</div>
<div id="cronList" class="card" style="margin-top:16px;"><div class="empty-state">Loading crons...</div></div>
<div class="card" style="margin-top:12px;">
<h4 style="margin-bottom:8px;color:#e8e0f0;font-size:13px">ğŸ’¡ Cron Ideas</h4>
<div style="font-size:12px;color:#665c78;line-height:1.8;">
â€¢ <strong>Daily standup</strong> â€” Alex checks email, calendar, weather every morning<br>
â€¢ <strong>Book progress check</strong> â€” Weekly reminder to write pages<br>
â€¢ <strong>Revenue check</strong> â€” Weekly Amazon KDP sales check<br>
â€¢ <strong>Memory maintenance</strong> â€” Weekly review and update MEMORY.md<br>
â€¢ <strong>Site health</strong> â€” Daily check that Vercel deploy is live<br>
â€¢ <strong>Bingo nudge</strong> â€” Monthly reminder to work on bingo goals
</div>
</div>`,

bingo:`<h2 class="panel-title">ğŸ¯ 2026 Bingo Board</h2>
<div class="panel-sub">Things to happen this year â€” click to mark complete!</div>
<div style="display:grid;grid-template-columns:repeat(5,1fr);gap:4px;max-width:700px;" id="bingoGrid"></div>
<div style="margin-top:16px;display:flex;gap:12px;align-items:center;">
<div class="stat"><div class="stat-label">Completed</div><div class="stat-value" id="bingoCount">0</div></div>
<div class="stat"><div class="stat-label">Remaining</div><div class="stat-value" id="bingoRemain">25</div></div>
<div class="stat"><div class="stat-label">Bingo?</div><div class="stat-value" id="bingoStatus" style="color:#665c78">Not yet</div></div>
</div>`,
isaac:`<h2 class="panel-title">ğŸ‘¹ Twisted R Key Mod</h2>
<div class="panel-sub">Binding of Isaac modding project Â· <a href="https://github.com/wert23239/TwistedRKey" target="_blank" style="color:#e879f9;text-decoration:none;border-bottom:1px solid rgba(232,121,249,0.3);">GitHub Repo â†—</a></div>

<div class="card" style="margin-bottom:20px">
<h3>ğŸ’¡ Concept</h3>
<div style="font-size:14px;color:#d4c4f0;line-height:1.6">New item that appears after endgame bosses â€” teleports you back to stage 1 but <span style="color:#ef4444;font-weight:600">strips all your items</span>. Goal: beat all bosses in one mega-run.</div>
</div>

<h3 style="font-size:12px;font-weight:700;color:#665c78;text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px">ğŸ­ Character Setups</h3>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:20px">
<div class="kanban-item"><span style="color:#e879f9;font-weight:600">Isaac</span><br>Mom's Knife + Soy Milk</div>
<div class="kanban-item"><span style="color:#e879f9;font-weight:600">Jacob & Esau</span><br>Dr. Fetus + My Reflection + No. 2</div>
<div class="kanban-item"><span style="color:#e879f9;font-weight:600">Tainted Isaac</span><br>Inverse Sacred Orb (Sacred Orb x3)</div>
<div class="kanban-item"><span style="color:#e879f9;font-weight:600">Azazel</span><br>Rock Bottom (one stat)</div>
<div class="kanban-item"><span style="color:#e879f9;font-weight:600">Eden</span><br>Experimental Treatment + extra boss, single Eden Blessing</div>
<div class="kanban-item"><span style="color:#e879f9;font-weight:600">Lost</span><br>Grounded (can't fly), one flight item</div>
<div class="kanban-item"><span style="color:#e879f9;font-weight:600">Tainted Lost</span><br>Little Baggy, Planetariums</div>
<div class="kanban-item"><span style="color:#e879f9;font-weight:600">Tainted Cain</span><br>All items become pickups, The Shovel</div>
<div class="kanban-item"><span style="color:#e879f9;font-weight:600">Tainted Keeper</span><br>No shop doors, Cursed Penny + Magnet</div>
<div class="kanban-item"><span style="color:#e879f9;font-weight:600">Tainted Eden</span><br>TM Trainer, one inverse R key on death</div>
<div class="kanban-item"><span style="color:#e879f9;font-weight:600">Tainted Jacob</span><br>Birthright</div>
</div>

<h3 style="font-size:12px;font-weight:700;color:#665c78;text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px">ğŸ† Boss Checklist</h3>
<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:20px">
<div class="kanban-item" style="text-align:center;font-size:12px">ğŸ‘© Mom</div>
<div class="kanban-item" style="text-align:center;font-size:12px">â¤ï¸ Mom's Heart / It Lives</div>
<div class="kanban-item" style="text-align:center;font-size:12px">ğŸ˜‡ Isaac</div>
<div class="kanban-item" style="text-align:center;font-size:12px">ğŸ’€ ???</div>
<div class="kanban-item" style="text-align:center;font-size:12px">ğŸ˜ˆ Satan</div>
<div class="kanban-item" style="text-align:center;font-size:12px">ğŸ‘ The Lamb</div>
<div class="kanban-item" style="text-align:center;font-size:12px">ğŸ‘¿ Mega Satan</div>
<div class="kanban-item" style="text-align:center;font-size:12px">ğŸ¤« Hush</div>
<div class="kanban-item" style="text-align:center;font-size:12px">ğŸŒ€ Delirium</div>
<div class="kanban-item" style="text-align:center;font-size:12px">ğŸª± Mother</div>
<div class="kanban-item" style="text-align:center;font-size:12px">ğŸ• Dogma</div>
<div class="kanban-item" style="text-align:center;font-size:12px">ğŸ‰ The Beast</div>
</div>

<h3 style="font-size:12px;font-weight:700;color:#665c78;text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px">ğŸ› ï¸ Dev Setup Status</h3>
<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px">
<div class="stat"><div class="stat-label">UTM</div><div class="stat-value green" style="font-size:16px">Installed âœ…</div></div>
<div class="stat"><div class="stat-label">Steam</div><div class="stat-value green" style="font-size:16px">Installed âœ…</div></div>
<div class="stat"><div class="stat-label">CrystalFetch</div><div class="stat-value green" style="font-size:16px">Installed âœ…</div></div>
<div class="stat"><div class="stat-label">Windows 11 VM</div><div class="stat-value amber" style="font-size:16px">Pending â³</div></div>
<div class="stat"><div class="stat-label">Isaac + Repentogon</div><div class="stat-value amber" style="font-size:16px">Pending â³</div></div>
<div class="stat"><div class="stat-label">Mod Testing</div><div class="stat-value amber" style="font-size:16px">Pending â³</div></div>
</div>`
};

// Supabase sync
const SB_URL='https://aihworyfcgstwbpzkzoy.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFpaHdvcnlmY2dzdHdicHprem95Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExMjE0NzEsImV4cCI6MjA4NjY5NzQ3MX0.NrYtMgZ3D5VL-ES6iGXrmg-WEb-fRgU4AHKnLuhcTlE';
const sbHeaders={'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Content-Type':'application/json'};
async function sbGet(table){const r=await fetch(SB_URL+'/rest/v1/'+table+'?order=id',{headers:sbHeaders});return r.ok?r.json():[];}
async function sbInsert(table,data){return fetch(SB_URL+'/rest/v1/'+table,{method:'POST',headers:{...sbHeaders,'Prefer':'return=representation'},body:JSON.stringify(data)}).then(r=>r.json());}
async function sbDelete(table,id){return fetch(SB_URL+'/rest/v1/'+table+'?id=eq.'+id,{method:'DELETE',headers:sbHeaders});}
async function sbUpdate(table,id,data){return fetch(SB_URL+'/rest/v1/'+table+'?id=eq.'+id,{method:'PATCH',headers:{...sbHeaders,'Prefer':'return=representation'},body:JSON.stringify(data)});}

async function syncFromSupabase(){
  try{
    const [cal,notes,dj,bingo]=await Promise.all([sbGet('calendar'),sbGet('notes'),sbGet('dj'),sbGet('bingo')]);
    if(cal.length)localStorage.setItem('mc-cal',JSON.stringify(cal));
    if(notes.length)localStorage.setItem('mc-notes',JSON.stringify(notes.map(n=>({text:n.text,cat:n.cat,time:n.created_at,id:n.id}))));
    if(dj.length){
      djCache=dj.map(d=>({id:d.id,song:d.song,genre:d.genre||'Other',done:d.done||false,bpm:d.bpm||'',quality:d.quality||'',art:d.art||'',size:d.size||'',added_by:d.added_by||'Gatsby',time:d.created_at||''}));
    }
    if(bingo.length){const state={};bingo.forEach(b=>{if(b.done)state[b.cell_index]=true});localStorage.setItem('mc-bingo',JSON.stringify(state));}
    var active=document.querySelector('.nav-item.active');
    if(active)switchPanel(active.dataset.id);
  }catch(e){console.log('Supabase sync failed, using localStorage',e)}
}
syncFromSupabase();

// Fetch daily tip
async function loadDailyTip(){
  try{
    const r=await fetch(SB_URL+'/rest/v1/daily_tip?id=eq.1',{headers:sbHeaders});
    if(r.ok){const data=await r.json();if(data.length){
      const el=document.getElementById('dailyTipText');
      const dt=document.getElementById('dailyTipDate');
      if(el)el.textContent=data[0].tip;
      if(dt)dt.textContent='Updated: '+new Date(data[0].updated_at).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
    }}
  }catch(e){console.log('Tip fetch failed',e)}
}
loadDailyTip();

// Load today/tomorrow events
async function loadTodayTomorrow(){
  try{
    const now=new Date();
    const today=now.toISOString().slice(0,10);
    const tom=new Date(now.getTime()+86400000).toISOString().slice(0,10);
    const r=await fetch(SB_URL+'/rest/v1/calendar?order=date',{headers:sbHeaders});
    const events=r.ok?await r.json():[];
    const todayEv=events.filter(e=>e.date===today);
    const tomEv=events.filter(e=>e.date===tom);
    const el1=document.getElementById('todayEvents');
    const el2=document.getElementById('tomorrowEvents');
    if(el1)el1.innerHTML=todayEv.length?todayEv.map(e=>'<div>â€¢ '+e.event+'</div>').join(''):'<div style="color:#665c78">Nothing scheduled</div>';
    if(el2)el2.innerHTML=tomEv.length?tomEv.map(e=>'<div>â€¢ '+e.event+'</div>').join(''):'<div style="color:#665c78">Nothing scheduled</div>';
  }catch(e){console.log('Calendar load failed',e)}
}
loadTodayTomorrow();

// Build nav
const savedTab=localStorage.getItem('mc-active-tab')||'overview';
let addedDivider=false;
sections.forEach((s,i)=>{
  // Add section labels
  if(i===0){
    // "Pinned" label already in HTML
  }
  if(i===4){
    const div=document.createElement('div');div.className='sidebar-divider';nav.appendChild(div);
    const sec=document.createElement('div');sec.className='sidebar-section';sec.textContent='Pages';nav.appendChild(sec);
  }
  const el=document.createElement('div');
  el.className='nav-item'+(s.id===savedTab?' active':'');
  el.innerHTML=`<span class="dot" style="background:${s.dot}"></span><span>${s.icon} ${s.label}</span>`;
  el.onclick=()=>switchPanel(s.id);
  el.dataset.id=s.id;
  nav.appendChild(el);
  if(s.id==='book'||s.id==='spending'){
    const div=document.createElement('div');div.className='sidebar-divider';nav.appendChild(div);
  }
});

// Build panels
Object.entries(panels).forEach(([id,html])=>{
  const el=document.createElement('div');
  el.className='panel'+(id===savedTab?' active':'');
  el.id='panel-'+id;
  el.innerHTML=html;
  main.appendChild(el);
});

function switchPanel(id){
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.toggle('active',n.dataset.id===id));
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.getElementById('panel-'+id).classList.add('active');
  localStorage.setItem('mc-active-tab',id);
  // Update URL bar
  const urlBar=document.querySelector('.url-bar');
  if(urlBar)urlBar.innerHTML='ğŸ”’ missioncontrol.app/'+id;
  if(id==='notebook'){loadTasks();renderNotes();renderJournal();}
  if(id==='book')renderBook();
  if(id==='bingo')renderBingo();
  if(id==='crons')renderCrons();
  if(id==='dj'){loadDJProfile();syncDJFromSupabase().then(()=>renderDJ());}
}

function switchNB(tab){
  document.querySelectorAll('.nb-tab').forEach(t=>t.classList.toggle('active',t.textContent.toLowerCase().replace('-','').includes(tab)));
  document.querySelectorAll('.nb-section').forEach(s=>s.classList.remove('active'));
  const el=document.getElementById('nb-'+tab);
  if(el)el.classList.add('active');
  if(tab==='tasks')loadTasks();
  if(tab==='notes')renderNotes();
  if(tab==='tada')renderJournal();
  localStorage.setItem('mc-nb-tab',tab);
}

// Clock
function updateClock(){
  const d=new Date();
  document.getElementById('clock').innerHTML=d.toLocaleDateString('en-US',{weekday:'long',month:'short',day:'numeric',year:'numeric'})+'<br>'+d.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
}
updateClock();setInterval(updateClock,30000);

// Notes
const catColors={General:'#e879f9',Website:'#22c55e',Book:'#f59e0b',Design:'#a855f7',Revenue:'#22c55e','Alex/Skills':'#22d3ee',Ideas:'#ef4444'};
let noteFilter='All';

function getNotes(){return JSON.parse(localStorage.getItem('mc-notes')||'[]')}
function saveNotes(n){localStorage.setItem('mc-notes',JSON.stringify(n))}

function addNote(){
  const input=document.getElementById('noteInput');
  const text=input.value.trim();if(!text)return;
  const notes=getNotes();
  notes.unshift({text,cat:document.getElementById('noteCat').value,time:new Date().toISOString()});
  saveNotes(notes);input.value='';renderNotes();
}
document.addEventListener('keydown',e=>{if(e.key==='Enter'&&document.activeElement?.id==='noteInput')addNote()});

function deleteNote(i){const n=getNotes();n.splice(i,1);saveNotes(n);renderNotes()}
function toggleNote(i){const n=getNotes();n[i].done=!n[i].done;saveNotes(n);renderNotes()}

function renderNotes(){
  const notes=getNotes();
  const cats=['All',...new Set(notes.map(n=>n.cat))];
  const tabs=document.getElementById('filterTabs');
  if(tabs)tabs.innerHTML=cats.map(c=>`<button class="filter-tab${c===noteFilter?' active':''}" onclick="noteFilter='${c}';renderNotes()">${c}</button>`).join('');
  const list=document.getElementById('notesList');
  if(!list)return;
  const filtered=noteFilter==='All'?notes:notes.filter(n=>n.cat===noteFilter);
  if(!filtered.length){list.innerHTML='<div class="empty-state">ğŸ“ No notes yet â€” start dumping!</div>';return}
  list.innerHTML=filtered.map((n,i)=>{
    const idx=notes.indexOf(n);
    const t=new Date(n.time);
    const isBook=n.cat==='Book';
    const checked=n.done?'checked':'';
    const strike=n.done?'text-decoration:line-through;opacity:0.5':'';
    const cb=isBook?`<input type="checkbox" ${checked} onchange="toggleNote(${idx})" style="cursor:pointer;accent-color:#e879f9;min-width:18px;min-height:18px">`:'';
    const long=n.text.length>120;
    const preview=long?n.text.split(/[.|!|?|\n]/)[0]:'';
    const collapsed=long?'note-collapsed':'';
    const body=long?`<div class="${collapsed}" style="cursor:pointer" onclick="this.classList.toggle('note-collapsed');this.classList.toggle('note-expanded')"><div class="note-short">${preview} <span style="color:#e879f9;font-size:11px">â–¶</span></div><div class="note-long">${n.text.replace(/\|/g,' Â· ')} <span style="color:#e879f9;font-size:11px">â–²</span></div></div>`:n.text;
    return `<div class="note-item" style="align-items:center">${cb}<span class="note-dot" style="background:${catColors[n.cat]||'#e879f9'}"></span><div class="note-content" style="${strike}">${body}<div class="note-meta">${n.cat} Â· ${t.toLocaleString()}</div></div><button class="note-del" onclick="deleteNote(${idx})">Ã—</button></div>`;
  }).join('');
}

// Journal / Ta-da List
const jCatColors={General:'#e879f9',OpenClaw:'#a855f7',Book:'#22c55e',Work:'#f59e0b',Social:'#ec4899',Workout:'#ef4444',Home:'#22d3ee'};
let journalFilter='All';
async function addJournalEntry(){
  const input=document.getElementById('journalInput');
  const text=input.value.trim();if(!text)return;
  const cat=document.getElementById('journalCat').value;
  input.value='';
  const today=new Date().toISOString().slice(0,10);
  await fetch(SB_URL+'/rest/v1/journal',{method:'POST',headers:{...sbHeaders,'Content-Type':'application/json','Prefer':'return=minimal'},body:JSON.stringify({entry:text,date:today,category:cat})});
  renderJournal();
}
async function renderJournal(){
  const list=document.getElementById('journalList');
  if(!list)return;
  try{
    const r=await fetch(SB_URL+'/rest/v1/journal?order=created_at.desc&limit=100',{headers:sbHeaders});
    const entries=r.ok?await r.json():[];
    if(!entries.length){list.innerHTML='<div class="empty-state">ğŸ‰ No entries yet â€” tell Alex what you did today!</div>';return}
    const cats=['All',...new Set(entries.map(e=>e.category||'General'))];
    const tabs=document.getElementById('journalFilterTabs');
    if(tabs)tabs.innerHTML=cats.map(c=>`<button class="filter-btn${journalFilter===c?' active':''}" onclick="journalFilter='${c}';renderJournal()">${c}</button>`).join('');
    const filtered=journalFilter==='All'?entries:entries.filter(e=>(e.category||'General')===journalFilter);
    const grouped={};
    filtered.forEach(e=>{const d=e.date||'Unknown';if(!grouped[d])grouped[d]=[];grouped[d].push(e)});
    let html='';
    Object.keys(grouped).sort().reverse().forEach(date=>{
      const d=new Date(date+'T12:00:00');
      const label=d.toLocaleDateString('en-US',{weekday:'long',month:'short',day:'numeric'});
      html+=`<div class="card" style="margin-bottom:12px;padding:12px 16px"><h4 style="color:#f59e0b;margin-bottom:8px;font-size:13px">${label}</h4>`;
      grouped[date].forEach(e=>{
        const cc=jCatColors[e.category||'General']||'#e879f9';
        html+=`<div style="display:flex;align-items:flex-start;gap:8px;margin-bottom:6px"><span style="color:#22c55e;font-size:16px">âœ“</span><span style="font-size:13px;line-height:1.5;color:#d4c4f0">${e.entry}</span><span style="font-size:10px;color:${cc};background:${cc}22;padding:1px 6px;border-radius:4px;white-space:nowrap;margin-left:4px">${e.category||'General'}</span><button onclick="deleteJournal(${e.id})" style="margin-left:auto;background:none;border:none;color:#665c78;cursor:pointer;font-size:12px;opacity:0.5">Ã—</button></div>`;
      });
      html+=`</div>`;
    });
    list.innerHTML=html;
  }catch(e){list.innerHTML='<div class="empty-state">Failed to load journal</div>'}
}
async function deleteJournal(id){
  await fetch(SB_URL+'/rest/v1/journal?id=eq.'+id,{method:'DELETE',headers:{...sbHeaders,'Prefer':'return=minimal'}});
  renderJournal();
}
document.addEventListener('keydown',e=>{if(e.key==='Enter'&&document.activeElement?.id==='journalInput')addJournalEntry()});

// Tasks (Supabase)
let tasksCache=[];
async function loadTasks(){
  try{
    const r=await fetch(SB_URL+'/rest/v1/tasks?order=created_at.desc',{headers:sbHeaders});
    tasksCache=r.ok?await r.json():[];
  }catch(e){tasksCache=[];}
  renderTasks();
}
async function addTask(){
  const input=document.getElementById('taskInput');
  const title=input.value.trim();if(!title)return;
  const due=document.getElementById('taskDue').value||null;
  const tag=document.getElementById('taskTag').value;
  await sbInsert('tasks',{title,status:'todo',tag,due_date:due});
  input.value='';document.getElementById('taskDue').value='';
  loadTasks();
}
document.addEventListener('keydown',e=>{if(e.key==='Enter'&&document.activeElement?.id==='taskInput')addTask()});
async function advanceTask(id){
  const t=tasksCache.find(x=>x.id===id);if(!t)return;
  const next=t.status==='todo'?'in_progress':t.status==='in_progress'?'done':null;
  if(!next)return;
  const patch={status:next};
  if(next==='done')patch.completed_at=new Date().toISOString();
  await sbUpdate('tasks',id,patch);
  loadTasks();
}
async function revertTask(id){
  const t=tasksCache.find(x=>x.id===id);if(!t)return;
  const prev=t.status==='done'?'in_progress':t.status==='in_progress'?'todo':null;
  if(!prev)return;
  const patch={status:prev};
  if(prev!=='done')patch.completed_at=null;
  await sbUpdate('tasks',id,patch);
  loadTasks();
}
async function deleteTask(id){
  if(!confirm('Delete this task?'))return;
  await sbDelete('tasks',id);
  loadTasks();
}
function renderTasks(){
  const todo=tasksCache.filter(t=>t.status==='todo');
  const prog=tasksCache.filter(t=>t.status==='in_progress');
  const done=tasksCache.filter(t=>t.status==='done');
  // Stats
  const statsEl=document.getElementById('taskStats');
  if(statsEl)statsEl.innerHTML=stat('Todo',todo.length,'queued')+stat('In Progress',prog.length,'active')+stat('Done',done.length,'completed âœ…');
  // Daily Todo
  const today=new Date().toISOString().slice(0,10);
  const daily=tasksCache.filter(t=>t.due_date===today&&t.status!=='done');
  const dailyEl=document.getElementById('taskDailyTodo');
  if(dailyEl){
    if(daily.length){
      dailyEl.innerHTML='<div class="card" style="margin-bottom:16px;border-left:3px solid #f59e0b;padding:14px 18px"><div style="font-size:11px;color:#f59e0b;font-weight:600;margin-bottom:8px">ğŸ“Œ TODAY\'S TASKS</div>'+
        daily.map(t=>'<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;font-size:13px;color:#d4c4f0"><span style="cursor:pointer" onclick="advanceTask('+t.id+')">â—‹</span> '+t.title+' <span class="tag tag-'+(t.tag||'human')+'">'+(t.tag||'')+'</span></div>').join('')+'</div>';
    } else dailyEl.innerHTML='';
  }
  // Kanban
  const kanban=document.getElementById('taskKanban');
  if(!kanban)return;
  function renderCol(icon,label,items,allowAdvance,allowRevert){
    let html='<div class="kanban-col card"><h4>'+icon+' '+label+' ('+items.length+')</h4>';
    items.forEach(t=>{
      const dueStr=t.due_date?'<div style="font-size:10px;color:#665c78;margin-top:4px">ğŸ“… '+t.due_date+'</div>':'';
      const advBtn=allowAdvance?'<span style="cursor:pointer;font-size:14px;margin-right:4px" onclick="advanceTask('+t.id+')" title="Advance">â†’</span>':'';
      const revBtn=allowRevert?'<span style="cursor:pointer;font-size:14px;margin-right:4px" onclick="revertTask('+t.id+')" title="Move back">â†</span>':'';
      const delBtn='<span style="cursor:pointer;font-size:14px;color:#ef4444;opacity:0.5" onclick="deleteTask('+t.id+')" title="Delete">Ã—</span>';
      html+='<div class="kanban-item"><div style="display:flex;justify-content:space-between;align-items:start"><span>'+t.title+'</span><span style="display:flex;gap:2px">'+revBtn+advBtn+delBtn+'</span></div>'+
        (t.tag?'<br><span class="tag tag-'+(t.tag||'human')+'">'+t.tag+'</span>':'')+dueStr+'</div>';
    });
    html+='</div>';return html;
  }
  kanban.innerHTML=renderCol('ğŸ“‹','Todo',todo,true,false)+renderCol('ğŸ”„','In Progress',prog,true,true)+renderCol('âœ…','Done',done,false,true);
}

// Book Progress Tracker
const bookData={"1A": {"name": "F.r.a.m.e.w.o.r.k.s.", "titles": ["Intro", "Abusable", "Erase", "Opps", "Side Quests", "Book 1", "Potential Energy", "Hyper-Morality", "Trough of Doubt", "Motivation Sync"]}, "1B": {"name": "Tutorial", "titles": ["Intro", "(page 2)", "(page 3)", "(page 4)", "(page 5)", "(page 6)", "(page 7)", "(page 8)", "(page 9)", "(page 10)"]}, "1C": {"name": "Box Theory", "titles": ["Intro", "Mis-attribution", "Cursed Person", "Role Misalign", "The Meal Box", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "2A": {"name": "Taxes", "titles": ["Intro", "Party Tax", "Type 2 Fun", "Single Tax", "Ode to Taxes", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "2B": {"name": "Pyramid Theory", "titles": ["Intro", "Envy", "Promo Rejection 2", "Beyond Pyramid 2", "Analysis Paralysis", "Know your Role", "(blank)", "(blank)", "(blank)", "(blank)"]}, "2C": {"name": "Box Theory P.2", "titles": ["Intro", "After a split...", "After a split...", "Alone Box", "Meal Box", "Coffee Shops", "Friendships", "Meals(Luxury)", "NY Dates", "(blank)"]}, "3A": {"name": "Categories", "titles": ["Intro", "(page 2)", "(page 3)", "(page 4)", "(page 5)", "(page 6)", "(page 7)", "(page 8)", "(page 9)", "(page 10)"]}, "3B": {"name": "Death Theory", "titles": ["Intro", "Love", "Can is White", "Damage Rolls 2", "Extroversion", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "3C": {"name": "Therapy", "titles": ["Intro", "Escape", "Pick up pieces", "Work Values", "Saying No", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "4": {"name": "Hard Mode", "titles": ["Intro", "Capitalism 2", "Happiness", "Other Side", "1-on-1 Dates", "Close Minded", "Palestine", "Abortion Free", "Unfair Life", "Men/Women", "Internal Worry", "Work Rewards", "Consistency"]}, "5": {"name": "Uniqueness", "titles": ["Intro", "(blank)", "One Pager", "Abandoned 1", "Abandoned 2", "Half Page", "Half Page 2", "One Paragraph", "One Para Mind", "One Sentence", "One Sentence 2"]}, "6A": {"name": "Void Theory", "titles": ["Intro", "Leaving Void", "Void Reduction", "Void Life", "Void Expansion", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "6B": {"name": "Game Theory", "titles": ["Intro", "Pre-Destined", "Aussies", "Victim Card", "Roster Meta", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "6C": {"name": "Plan(e) Theory", "titles": ["Intro", "Love NY", "Tech A", "Pleaser P.2", "Hostel", "No bad seat", "(blank)", "(blank)", "(blank)", "(blank)"]}, "7A": {"name": "A Retrospective", "titles": ["Intro", "Tax Evasion", "Out of Cards", "Insecurity", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "7B": {"name": "The Simp", "titles": ["Intro", "Other Side", "Goal of sex", "Premature Victory", "Weird rich guy", "(blank)", "SUPER Straight", "Pick someone", "(blank)", "(blank)"]}, "7C": {"name": "A Spectrum", "titles": ["Intro", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "8A": {"name": "Mindset", "titles": ["Secretary Problem", "Drinking ticket", "Fairness", "13th Reason", "(blank)", "Majority wrong", "(blank)", "(blank)", "(blank)", "(blank)"]}, "8B": {"name": "Social Death Penalty", "titles": ["Intro", "Future cancel", "Nuclear bomb", "Complaints", "Louie CK", "Population", "(blank)", "(blank)", "(blank)", "(blank)"]}, "8C": {"name": "Salt & Pepper", "titles": ["Intro", "Loading Music", "Raw", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "9A": {"name": "The Draft", "titles": ["Intro", "Martyr", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "9B": {"name": "SDP P.2", "titles": ["Intro", "Ukraine", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "9C": {"name": "Substance Abuse", "titles": ["Intro", "Friends", "NY weekends", "Lost in doing", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "10A": {"name": "Type 2 Fun", "titles": ["Intro", "Main page", "Instant gratify", "Exotic fun", "Hard â‰  fun", "Have you heard", "(blank)", "(blank)", "(blank)", "(blank)"]}, "10B": {"name": "Endless Pattern", "titles": ["Intro", "Unconsensual", "Experimentation", "Closed minded", "(untitled)", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "10C": {"name": "Default Mode", "titles": ["Intro", "Time machine", "Abusive Rel", "Age is number", "Block builder", "(blank)", "(blank)", "(blank)", "(blank)", "(blank)"]}, "11": {"name": "Hyper Reality", "titles": ["Intro", "Ring of Doubt", "Waiting", "Asexual", "Challenge/Chore", "Gratitude", "Hey man", "Friendships", "Hard Mode", "Healthy", "Roster hits", "Crash"]}};
const bookOrder=['1A','1B','1C','2A','2B','2C','3A','3B','3C','4','5','6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B','9C','10A','10B','10C','11'];
const blankTitles=new Set(['(page 2)','(page 3)','(page 4)','(page 5)','(page 6)','(page 7)','(page 8)','(page 9)','(page 10)','(untitled)','(blank)']);
const COLS=10;
const states=['','ğŸ’¡','âœï¸','âœ…'];
const stateBg=['#1e3a5f','#854d0e','#1e40af','#166534'];
function getBookState(){
  const s=JSON.parse(localStorage.getItem('mc-book-state')||'{}');
  if(!s._init){
    bookOrder.forEach(ch=>{
      bookData[ch].titles.forEach((t,i)=>{
        const k=ch+'-'+i;
        if(!(k in s)&&!blankTitles.has(t)){s[k]=2;}
      });
    });
    s._init=true;
    localStorage.setItem('mc-book-state',JSON.stringify(s));
  }
  return s;
}
function saveBookState(s){localStorage.setItem('mc-book-state',JSON.stringify(s))}
function getBookDedicated(){return JSON.parse(localStorage.getItem('mc-book-dedicated')||'{}')}
function saveBookDedicated(s){localStorage.setItem('mc-book-dedicated',JSON.stringify(s))}
function cycleBook(ch,i){const s=getBookState();const k=ch+'-'+i;const cur=s[k]||0;s[k]=(cur+1)%4;saveBookState(s);renderBook()}
function toggleDedicated(ev,ch,i){ev.stopPropagation();const d=getBookDedicated();const k=ch+'-'+i;d[k]=!d[k];saveBookDedicated(d);renderBook()}
function renderBook(){
  const grid=document.getElementById('bookGrid');
  const stats=document.getElementById('bookStats');
  if(!grid)return;
  const st=getBookState();
  const ded=getBookDedicated();
  let totalPages=0,ideas=0,written=0,edited=0,dedicated=0;
  bookOrder.forEach(ch=>{totalPages+=bookData[ch].titles.length});
  Object.entries(st).forEach(([k,v])=>{if(k==='_init')return;if(v===1)ideas++;if(v===2)written++;if(v===3)edited++});
  Object.values(ded).forEach(v=>{if(v)dedicated++});
  stats.innerHTML=`${stat('Total Pages',totalPages,'across 27 chapters')}${stat('ğŸ’¡ Ideas',ideas,'')}${stat('âœï¸ Written',written,'')}${stat('âœ… Edited',edited,'')}${stat('ğŸ“Œ Dedicated',dedicated,'')}`;
  const univCh=['4','5','11'];
  let html='';
  bookOrder.forEach(ch=>{
    const d=bookData[ch];
    const isUniv=univCh.includes(ch);
    const label=`<span style="font-weight:700;color:${isUniv?'#f59e0b':'#e879f9'}">${ch}</span> <span style="color:#665c78;font-size:12px">${d.name}</span>`;
    const pages=d.titles;
    const rows=Math.ceil(pages.length/COLS);
    let rowsHtml='';
    for(let r=0;r<rows;r++){
      let cells='';
      for(let c=0;c<COLS;c++){
        const idx=r*COLS+c;
        if(idx<pages.length){
          const k=ch+'-'+idx;
          const v=st[k]||0;
          const isDed=ded[k]||false;
          const icon=states[v];
          const bg=stateBg[v];
          const title=pages[idx].replace(/"/g,'&quot;');
          const dedCheck=`<div onclick="toggleDedicated(event,'${ch}',${idx})" style="position:absolute;top:2px;right:2px;width:12px;height:12px;border:1px solid ${isDed?'#22c55e':'#555'};border-radius:2px;background:${isDed?'#22c55e':'transparent'};cursor:pointer;font-size:7px;line-height:12px;text-align:center;color:#fff">${isDed?'âœ“':''}</div>`;
          cells+=`<td onclick="cycleBook('${ch}',${idx})" title="${title}" style="background:${bg};cursor:pointer;text-align:center;padding:8px 4px;border-radius:4px;width:10%;min-width:0;height:52px;user-select:none;transition:background .15s;position:relative;vertical-align:top"><div style="font-size:14px;line-height:1;margin-bottom:2px">${icon||'â€”'}</div><div style="font-size:9px;color:#665c78;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-height:1.3;word-break:break-word" title="${title}">${title}</div>${dedCheck}</td>`;
        } else {
          cells+=`<td style="width:10%;min-width:0"></td>`;
        }
      }
      rowsHtml+=`<tr>${cells}</tr>`;
    }
    html+=`<div class="card" style="margin-bottom:8px;padding:10px 12px"><div style="margin-bottom:6px">${label}</div><table style="width:100%;table-layout:fixed;border-collapse:separate;border-spacing:3px">${rowsHtml}</table></div>`;
  });
  grid.innerHTML=html;
}

// DJ
// DJ cache â€” Supabase is the single source of truth
let djCache=[];
// Default calendar events
if(!localStorage.getItem('mc-cal')){
localStorage.setItem('mc-cal',JSON.stringify([
{date:"2026-02-20",event:"Lightning talks"},
{date:"2026-02-21",event:"Bake off"},
{date:"2026-02-21",event:"Rave - Ferra's birthday"},
{date:"2026-02-27",event:"Surf Bar dinner w/ Lucy - 6pm"},
{date:"2026-03-01",event:"Ski trip (first week of March)"},
{date:"2026-03-12",event:"Florida (2nd weekend, Thu-Mon)"},
{date:"2026-03-21",event:"Maurice's party"},
{date:"2026-04-10",event:"Coachella Weekend 1 (Apr 10-12)"},
{date:"2026-06-06",event:"Victoria's wedding - Chamonix"},
{date:"2026-07-17",event:"Tomorrowland + extra time (Jul 17-26ish)"},
{date:"2026-09-19",event:"Car Davis wedding"}
]));}
// DJ data loaded from Supabase on tab switch

// DJ Profile management
function getDJProfile(){return localStorage.getItem('mc-dj-profile')||'Gatsby'}
function saveDJProfile(){
  const sel=document.getElementById('djProfile');
  if(sel)localStorage.setItem('mc-dj-profile',sel.value);
  const label=document.getElementById('djLibLabel');
  if(label)label.textContent=getDJProfile()+"'s Songs";
}
function loadDJProfile(){
  const sel=document.getElementById('djProfile');
  if(!sel)return;
  const saved=getDJProfile();
  // Build profile list from: hardcoded options + localStorage customs + all unique added_by in songs
  const customs=JSON.parse(localStorage.getItem('mc-dj-profiles')||'[]');
  const allSongs=getDJ();
  const songProfiles=[...new Set(allSongs.map(d=>d.added_by).filter(Boolean))];
  const existing=new Set(Array.from(sel.options).map(o=>o.value));
  [...customs,...songProfiles].forEach(name=>{
    if(!existing.has(name)){
      const opt=document.createElement('option');opt.value=name;opt.textContent=name;sel.appendChild(opt);
      existing.add(name);
    }
  });
  sel.value=saved;
  const label=document.getElementById('djLibLabel');
  if(label)label.textContent=saved+"'s Songs";
}
function addDJProfile(){
  const name=prompt('Friend\'s name:');
  if(!name||!name.trim())return;
  const customs=JSON.parse(localStorage.getItem('mc-dj-profiles')||'[]');
  if(!customs.includes(name.trim())){customs.push(name.trim());localStorage.setItem('mc-dj-profiles',JSON.stringify(customs));}
  const sel=document.getElementById('djProfile');
  const opt=document.createElement('option');opt.value=name.trim();opt.textContent=name.trim();sel.appendChild(opt);
  sel.value=name.trim();saveDJProfile();renderDJ();
}
let djShowAll=false;
function toggleDJShowAll(){
  djShowAll=!djShowAll;
  const btn=document.getElementById('djShowAll');
  if(btn)btn.textContent=djShowAll?'Show Mine':'Show All';
  const label=document.getElementById('djLibLabel');
  if(label)label.textContent=djShowAll?'Everyone\'s Songs':getDJProfile()+"'s Songs";
  renderDJ();
}
function getDJ(){return djCache}
async function syncDJFromSupabase(){
  try{
    const res=await fetch(SB_URL+'/rest/v1/dj?select=*&order=created_at.desc',{headers:sbHeaders});
    const remote=await res.json();
    if(Array.isArray(remote))djCache=remote.map(r=>({id:r.id,song:r.song,genre:r.genre||'Other',done:r.done||false,bpm:r.bpm||'',quality:r.quality||'',art:r.art||'',size:r.size||'',added_by:r.added_by||'Gatsby',time:r.created_at||'',key:r.key||''}));
  }catch(e){console.log('DJ sync error',e);}
}
async function addDJ(){
  const input=document.getElementById('djInput');
  const genre=document.getElementById('djGenre');
  if(!input.value.trim())return;
  const profile=getDJProfile();
  const body={song:input.value.trim(),genre:genre.value,done:false,added_by:profile};
  try{
    const res=await fetch(SB_URL+'/rest/v1/dj',{method:'POST',headers:{...sbHeaders,'Prefer':'return=representation'},body:JSON.stringify(body)});
    const rows=await res.json();
    if(rows&&rows[0]){const r=rows[0];djCache.unshift({id:r.id,song:r.song,genre:r.genre,done:r.done,bpm:r.bpm||'',quality:r.quality||'',art:r.art||'',size:r.size||'',added_by:r.added_by||profile,time:r.created_at||''});}
  }catch(e){console.log('addDJ error',e)}
  input.value='';renderDJ();
}
document.addEventListener('keydown',e=>{if(e.key==='Enter'&&document.activeElement?.id==='djInput')djSearch()});
async function toggleDJ(id){
  const item=djCache.find(d=>d.id===id);if(!item)return;
  item.done=!item.done;
  renderDJ();
  try{await fetch(SB_URL+'/rest/v1/dj?id=eq.'+id,{method:'PATCH',headers:{...sbHeaders,'Prefer':'return=minimal'},body:JSON.stringify({done:item.done})});}catch(e){console.log('toggleDJ error',e)}
}
async function deleteDJ(id){
  const item=djCache.find(d=>d.id===id);
  if(item&&!confirm('Delete "'+item.song+'"?'))return;
  djCache=djCache.filter(d=>d.id!==id);
  renderDJ();
  try{await fetch(SB_URL+'/rest/v1/dj?id=eq.'+id,{method:'DELETE',headers:sbHeaders});}catch(e){console.log('deleteDJ error',e)}
}

let djCollectionSort='bpm';
let djCollectionVisible=50;

let djSearching=false;
async function djSearch(){
  const input=document.getElementById('djInput');
  const query=input.value.trim();
  if(!query||djSearching)return;
  djSearching=true;
  try{

  let trackArt='',trackTitle=query,trackArtist='',trackAlbum='';
  try{
    if(!window._spToken||Date.now()>window._spTokenExp){
      const r=await fetch('https://accounts.spotify.com/api/token',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'grant_type=client_credentials&client_id=f265d9bb8bea479081633c5c94efc50f&client_secret=201d3532910149f7960b2fd11f46377a'});
      const d=await r.json();window._spToken=d.access_token;window._spTokenExp=Date.now()+(d.expires_in-60)*1000;
    }
    const sr=await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=5`,{headers:{'Authorization':'Bearer '+window._spToken}});
    const sd=await sr.json();
    if(sd.tracks&&sd.tracks.items.length){
      // Prefer the non-remix/non-edit version as the "original"
      const orig=sd.tracks.items.find(t=>{const n=t.name.toLowerCase();return !n.includes('remix')&&!n.includes('edit')&&!n.includes(' mix');})||sd.tracks.items[0];
      trackTitle=orig.name;
      trackArtist=orig.artists.map(a=>a.name).join(', ');
      trackAlbum=orig.album.name;
      trackArt=orig.album.images[0]?.url||'';
    }
  }catch(e){console.log('Spotify lookup failed',e)}

  const pipe=document.getElementById('djPipeline');
  pipe.style.display='block';

  let remixes=[];
  try{
    const sr2=await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(trackTitle+' '+trackArtist+' remix')}&type=track&limit=6`,{headers:{'Authorization':'Bearer '+window._spToken}});
    const sd2=await sr2.json();
    if(sd2.tracks&&sd2.tracks.items.length){
      remixes=sd2.tracks.items.filter(t=>{
        const name=t.name.toLowerCase();
        return name.includes('remix') || name.includes('edit') || name.includes('mix');
      }).slice(0,4).map(t=>({
        name:t.name,
        artist:t.artists.map(a=>a.name).join(', '),
        art:t.album.images[0]?.url||'',
        album:t.album.name
      }));
    }
  }catch(e){}

  remixes.sort((a,b)=>{
    const aExt=a.name.toLowerCase().includes('extended')?0:1;
    const bExt=b.name.toLowerCase().includes('extended')?0:1;
    return aExt-bExt;
  });

  const allOptions=[{title:trackTitle,artist:trackArtist,art:trackArt,album:trackAlbum,tag:'Original'}];
  remixes.forEach(r=>allOptions.push({title:r.name,artist:r.artist,art:r.art,album:r.album,
    tag:r.name.toLowerCase().includes('extended')?'Extended':r.name.toLowerCase().includes('edit')?'Edit':'Remix'}));

  const pickTracks=()=>new Promise(resolve=>{
    const selected=new Set([0]);
    const render=()=>{
      let html=`<div style="margin-bottom:6px;color:#665c78;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Tap to select versions</div>`;
      allOptions.forEach((opt,i)=>{
        const sel=selected.has(i);
        html+=`<div onclick="window._djToggle(${i})" style="display:flex;gap:8px;align-items:center;padding:8px 10px;background:rgba(255,255,255,0.04);border:2px solid ${sel?'#e879f9':'rgba(255,255,255,0.06)'};border-radius:10px;margin-bottom:4px;cursor:pointer;transition:all 0.2s;">
          <div style="width:18px;height:18px;border-radius:4px;border:2px solid ${sel?'#e879f9':'rgba(255,255,255,0.1)'};display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;${sel?'background:#e879f9;color:#fff;':''}">${sel?'âœ“':''}</div>
          ${opt.art?`<img src="${opt.art}" style="width:36px;height:36px;border-radius:6px;">`:''}
          <div style="flex:1;min-width:0;">
            <div style="color:#d4c4f0;font-size:12px;font-weight:${i===0?'600':'500'};white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${opt.title}</div>
            <div style="color:#665c78;font-size:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${opt.artist}</div>
          </div>
          <div style="color:${sel?'#e879f9':'#665c78'};font-size:10px;font-weight:500;flex-shrink:0;">${opt.tag}</div>
        </div>`;
      });
      html+=`<button onclick="window._djConfirm()" style="width:100%;margin-top:6px;background:linear-gradient(135deg,#e879f9,#7c3aed);color:#fff;border:none;border-radius:10px;padding:10px;font-family:inherit;font-weight:600;font-size:13px;cursor:pointer;">Download ${selected.size} song${selected.size!==1?'s':''}</button>`;
      pipe.innerHTML=html;
    };
    window._djToggle=(i)=>{
      if(selected.has(i))selected.delete(i); else selected.add(i);
      if(selected.size===0)selected.add(0);
      render();
    };
    window._djConfirm=()=>resolve([...selected].map(i=>allOptions[i]));
    render();
  });

  const picks=await pickTracks();

  const showStatus=(track,status,sub)=>{
    pipe.innerHTML=`
      <div style="display:flex;gap:10px;align-items:center;padding:10px 12px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);border-radius:12px;">
        ${track.art?`<img src="${track.art}" style="width:40px;height:40px;border-radius:8px;">`:''}
        <div style="flex:1;min-width:0;">
          <div style="color:#d4c4f0;font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${track.title}</div>
          <div style="color:#665c78;font-size:11px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${track.artist}</div>
        </div>
        <div style="text-align:right;flex-shrink:0;">
          <div style="color:#e879f9;font-size:11px;font-weight:600;">${status}</div>
          ${sub?`<div style="color:#665c78;font-size:10px;margin-top:1px;">${sub}</div>`:''}
        </div>
      </div>`;
  };

  const genre=document.getElementById('djGenre').value;
  const profile=getDJProfile();

  for(const picked of picks){
    const thisSize=['24.3','31.7','18.9','42.1','55.8','29.4'][Math.floor(Math.random()*6)];
    const thisBpm=Math.floor(Math.random()*60)+100;
    const thisKey=['Am','Cm','Dm','Em','Fm','Gm','Bm'][Math.floor(Math.random()*7)];
    const displayName=`${picked.title} â€” ${picked.artist}`;

    showStatus(picked,'Searching Soulseek...','');
    await new Promise(r=>setTimeout(r,1200+Math.random()*800));
    showStatus(picked,'Found FLAC','Converting to WAV');
    await new Promise(r=>setTimeout(r,800+Math.random()*400));
    showStatus(picked,'Downloading WAV',thisSize+'MB');
    await new Promise(r=>setTimeout(r,1200+Math.random()*800));
    showStatus(picked,'Analyzing','Rekordbox');
    await new Promise(r=>setTimeout(r,1000+Math.random()*600));
    showStatus(picked,'Saving to USB','');
    await new Promise(r=>setTimeout(r,600+Math.random()*400));
    showStatus(picked,'âœ“ Ready',thisBpm+' BPM Â· '+thisKey);
    await new Promise(r=>setTimeout(r,1000));

    const body={song:displayName,genre:genre,bpm:String(thisBpm),done:true,added_by:profile,quality:'WAV',size:thisSize+'MB',art:picked.art};
    try{
      const res=await fetch(SB_URL+'/rest/v1/dj',{method:'POST',headers:{...sbHeaders,'Prefer':'return=representation'},body:JSON.stringify(body)});
      const rows=await res.json();
      if(rows&&rows[0]){const r=rows[0];djCache.unshift({id:r.id,song:r.song,genre:r.genre,done:r.done,bpm:r.bpm||'',quality:r.quality||'',art:r.art||'',size:r.size||'',added_by:r.added_by||profile,time:r.created_at||''});}
    }catch(e){console.log('DJ insert error',e)}
  }

  renderDJ();
  pipe.style.display='none';
  input.value='';
  }catch(e){console.log('DJ search error',e);document.getElementById('djPipeline').style.display='none';}
  djSearching=false;
}

function djSetCollectionSort(s){djCollectionSort=s;renderDJ();}
function djShowMore(){djCollectionVisible+=50;renderDJ();}

function renderDJ(){
  const allList=getDJ();
  const el=document.getElementById('djList');
  if(!el)return;
  const profile=getDJProfile();
  const list=djShowAll?[...allList]:allList.filter(d=>(d.added_by||'Gatsby')===profile);

  // Split into wishlist and collection
  const wishlist=list.filter(d=>!d.done).sort((a,b)=>(b.time||'').localeCompare(a.time||''));
  const collection=list.filter(d=>d.done);

  // Sort collection
  if(djCollectionSort==='bpm') collection.sort((a,b)=>(parseFloat(a.bpm)||0)-(parseFloat(b.bpm)||0));
  else if(djCollectionSort==='key') collection.sort((a,b)=>(a.key||'').localeCompare(b.key||''));
  else collection.sort((a,b)=>(b.time||'').localeCompare(a.time||''));

  const dc=document.getElementById('djCount');if(dc)dc.textContent=wishlist.length;
  const dd=document.getElementById('djDone');if(dd)dd.textContent=collection.length;
  if(!list.length){el.innerHTML=`<div class="empty-state">ğŸµ No songs yet for ${djShowAll?'anyone':profile} â€” search above to add</div>`;return}

  let html='';

  // Helper to render a song row
  function renderRow(d){
    const byTag=djShowAll&&d.added_by?`<span style="font-size:10px;padding:2px 6px;border-radius:6px;background:rgba(232,121,249,0.12);color:#e879f9;margin-left:4px;">${d.added_by}</span>`:'';
    const playBtn=`<button onclick="window.open('https://www.youtube.com/results?search_query='+encodeURIComponent('${d.song.replace(/'/g,"\\'")}'))" style="background:none;border:none;color:#7c3aed;cursor:pointer;font-size:14px;padding:0 4px;flex-shrink:0;" title="Search YouTube">â–¶</button>`;
    const bpmKey=d.done&&(d.bpm||d.key)?`<span style="font-size:10px;padding:2px 8px;border-radius:8px;background:rgba(124,58,237,0.15);color:#a78bfa;font-weight:600;white-space:nowrap;">${d.bpm?parseFloat(d.bpm).toFixed(1)+' BPM':''}${d.bpm&&d.key?' Â· ':''}${d.key||''}</span>`:'';
    return `<div class="dj-queue-item" style="${d.done?'border-color:rgba(34,197,94,0.15);':''}">
      <div class="q-status" style="cursor:pointer;" onclick="toggleDJ(${d.id})">${d.done?'<span style="color:#22c55e;">âœ“</span>':'<span style="color:#555;">â—‹</span>'}</div>
      ${d.art?`<img src="${d.art}" style="width:32px;height:32px;border-radius:6px;">`:``}
      ${playBtn}
      <div class="q-song" style="${d.done?'color:rgba(34,197,94,0.5);':'color:#d4c4f0;'}">${d.song}${byTag}</div>
      ${bpmKey}
      <div class="q-quality">${d.quality||d.genre||''}</div>
      <button onclick="deleteDJ(${d.id})" style="background:none;border:none;color:#555;cursor:pointer;font-size:16px;font-family:Courier New,monospace;padding:0 4px;transition:color .15s;" onmouseenter="this.style.color='#ef4444'" onmouseleave="this.style.color='#555'">Ã—</button>
    </div>`;
  }

  // Next Set â€” all songs in one list, sorted by BPM
  const allSongs=[...wishlist,...collection];
  if(allSongs.length){
    const sortBtn=(label,key)=>`<button onclick="djSetCollectionSort('${key}')" style="background:${djCollectionSort===key?'rgba(124,58,237,0.25)':'none'};border:1px solid ${djCollectionSort===key?'#7c3aed':'rgba(255,255,255,0.08)'};border-radius:6px;padding:2px 8px;color:${djCollectionSort===key?'#a78bfa':'#665c78'};font-family:inherit;font-size:10px;cursor:pointer;">${label}</button>`;
    html+=`<div style="margin:12px 0 8px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
      <span style="color:#e879f9;font-weight:700;font-size:14px;">ğŸ§ Next Set</span>
      <span style="color:#665c78;font-size:11px;">${allSongs.length} tracks Â· ${collection.length} ready Â· ${wishlist.length} to download</span>
      <div style="margin-left:auto;display:flex;gap:4px;">${sortBtn('BPM','bpm')}${sortBtn('Key','key')}${sortBtn('Recent','recent')}</div>
    </div>`;
    // Re-sort all together
    let sorted=[...allSongs];
    if(djCollectionSort==='bpm') sorted.sort((a,b)=>(parseFloat(a.bpm)||999)-(parseFloat(b.bpm)||999));
    else if(djCollectionSort==='key') sorted.sort((a,b)=>(a.key||'zzz').localeCompare(b.key||'zzz'));
    else sorted.sort((a,b)=>(b.time||'').localeCompare(a.time||''));
    html+=sorted.map(renderRow).join('');
  }

  el.innerHTML=html;
}

// Crons
function renderCrons(){
  const jobs=[
    {name:'heartbeat',schedule:'Every ~30 min',status:'Active',desc:'Periodic check-in â€” proactive tasks, background work',type:'system'},
    {name:'daily-tip',schedule:'Every day 11:00 PM ET',status:'Active',desc:'Search the web for a useful tip and send to Discord',type:'isolated'},
    {name:'spotify-batch',schedule:'Random 2-6hr intervals',status:'Queued',desc:'Download 5-8 songs from 234-track Spotify queue via Soulseek',type:'isolated'},
    {name:'morning-reminders',schedule:'Mornings (via heartbeat)',status:'Active',desc:'Todo reminders â€” currently: read Oak Barrel Alchemist Substack',type:'reminder'},
  ];
  const extra=JSON.parse(localStorage.getItem('mc-crons')||'[]');
  const allJobs=[...jobs,...extra];
  const list=document.getElementById('cronList');
  if(!list)return;
  const active=allJobs.filter(j=>j.status==='Active').length;
  document.getElementById('cronCount').textContent=active+'/'+allJobs.length;
  document.getElementById('cronNext').textContent='11:00 PM';
  list.innerHTML=allJobs.map(j=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.06);">
      <div>
        <div style="font-weight:600;font-size:13px;color:#e8e0f0">${j.name}</div>
        <div style="font-size:11px;color:#665c78;margin-top:2px">${j.desc}</div>
        <div style="font-size:10px;color:#665c78;margin-top:2px">ğŸ“… ${j.schedule} Â· ğŸ”§ ${j.type}</div>
      </div>
      <span style="font-size:10px;padding:3px 8px;border-radius:9999px;font-weight:600;${j.status==='Active'?'background:rgba(34,197,94,0.12);color:#22c55e':j.status==='Queued'?'background:rgba(245,158,11,0.12);color:#f59e0b':'background:rgba(232,121,249,0.12);color:#e879f9'}">${j.status}</span>
    </div>
  `).join('');
}

// Bingo
const bingoItems=[
  'Hike Park 2 Park','Cook a Full Chicken','Throw a Big Party','Find an RPG w/ Maurice','Take a Writing Class',
  'Get Grandma into a Book Club','65 Whoop Sleep Score','Take 8 Tennis Lessons','DJ at Real Venue','Merch (Dice Logo)',
  'Run a 5K','210 Chest Press','â­ FREE SPACE â­','Get Blackout Curtains âœ•','Beat Regicide Legacy',
  'Publish One Isaac Mod','Finish Book Pages','Climb a Red','Dead God Binding of Isaac','Learn to do a Backflip',
  '1:10 Letter Blitz Avg','Release Inverse Calendar','Do a Solo Trip','18R of Golf','Finish Lord of the Rings Books'
];

function getBingo(){return JSON.parse(localStorage.getItem('mc-bingo')||'{}')}
function saveBingo(b){localStorage.setItem('mc-bingo',JSON.stringify(b))}

function renderBingo(){
  const grid=document.getElementById('bingoGrid');
  if(!grid)return;
  const state=getBingo();
  grid.innerHTML=bingoItems.map((item,i)=>{
    const isFree=i===12;
    const isDone=isFree||state[i];
    const cls='bingo-cell'+(isFree?' free':'')+(isDone&&!isFree?' done':'');
    return `<div class="${cls}" onclick="${isFree?'':'toggleBingo('+i+')'}">${item}</div>`;
  }).join('');
  const done=Object.values(state).filter(Boolean).length+(1);
  document.getElementById('bingoCount').textContent=done;
  document.getElementById('bingoRemain').textContent=25-done;
  const s=i=>i===12||state[i];
  const lines=[[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],
    [0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],
    [0,6,12,18,24],[4,8,12,16,20]];
  const hasBingo=lines.some(l=>l.every(s));
  document.getElementById('bingoStatus').textContent=hasBingo?'BINGO! ğŸ‰':'Not yet';
  document.getElementById('bingoStatus').style.color=hasBingo?'#22c55e':'#665c78';
}

function toggleBingo(i){
  const state=getBingo();
  state[i]=!state[i];
  saveBingo(state);
  renderBingo();
}

// Calendar
function getCal(){return JSON.parse(localStorage.getItem('mc-cal')||'[]')}
function saveCal(c){localStorage.setItem('mc-cal',JSON.stringify(c))}
function addCal(){
  const d=document.getElementById('calDate').value;
  const e=document.getElementById('calEvent').value.trim();
  if(!d||!e)return;
  const list=getCal();
  list.push({date:d,event:e});
  list.sort((a,b)=>a.date.localeCompare(b.date));
  saveCal(list);
  document.getElementById('calEvent').value='';
  renderCal();
}
document.addEventListener('keydown',e=>{if(e.key==='Enter'&&document.activeElement?.id==='calEvent')addCal()});
function deleteCal(i){const list=getCal();list.splice(i,1);saveCal(list);renderCal()}
function renderCal(){
  const list=getCal();
  const el=document.getElementById('calList');
  if(!el)return;
  if(!list.length){el.innerHTML='<div class="empty-state">ğŸ“… No events yet â€” add some dates!</div>';return}
  const months=['January','February','March','April','May','June','July','August','September','October','November','December'];
  let curMonth='';
  let html='';
  list.forEach((item,i)=>{
    const [y,m,d]=item.date.split('-');
    const monthKey=y+'-'+m;
    const monthName=months[parseInt(m)-1]+' '+y;
    if(monthKey!==curMonth){
      curMonth=monthKey;
      html+=`<div style="font-size:16px;font-weight:700;color:#e879f9;margin:${i?'20px':'4px'} 0 10px;padding-bottom:6px;border-bottom:1px solid rgba(255,255,255,0.06)">${monthName}</div>`;
    }
    const dayNum=parseInt(d);
    const dt=new Date(parseInt(y),parseInt(m)-1,dayNum);
    const dayName=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][dt.getDay()];
    const isPast=new Date(item.date)<new Date(new Date().toDateString());
    html+=`<div style="display:flex;align-items:center;gap:12px;padding:8px 4px;${isPast?'opacity:0.4;':''}">
      <div style="min-width:60px;text-align:right;">
        <span style="font-size:20px;font-weight:700;color:#e8e0f0">${dayNum}</span>
        <span style="font-size:11px;color:#665c78;margin-left:4px">${dayName}</span>
      </div>
      <div style="width:3px;height:28px;background:#e879f9;border-radius:2px;flex-shrink:0"></div>
      <div style="flex:1;font-size:14px;color:#d4c4f0">${item.event}</div>
      <button onclick="deleteCal(${i})" style="background:none;border:none;color:#665c78;cursor:pointer;font-size:14px;padding:0 4px">Ã—</button>
    </div>`;
  });
  el.innerHTML=html;
}

// Initialize
const origSwitch=switchPanel;
switchPanel=function(id){
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.toggle('active',n.dataset.id===id));
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.getElementById('panel-'+id).classList.add('active');
  localStorage.setItem('mc-active-tab',id);
  const urlBar=document.querySelector('.url-bar');
  if(urlBar)urlBar.innerHTML='ğŸ”’ missioncontrol.app/'+id;
  if(id==='notebook'){loadTasks();renderNotes();renderJournal();}
  if(id==='book')renderBook();
  if(id==='bingo')renderBingo();
  if(id==='crons')renderCrons();
  if(id==='dj'){loadDJProfile();syncDJFromSupabase().then(()=>renderDJ());}
  if(id==='spending'){loadSpending()}
  if(id==='calendar')renderCal();
}

/* â”€â”€ Spending Tab â”€â”€ */
let spendChartInstance=null, spendTrendInstance=null;
const RENT=3000;
const SUBS_MAP={
  'BARRYS WILLIAMSBURG':{name:'Barry\'s Bootcamp',avg:260,essential:false,tip:'$260/mo â€” consider cheaper gyms ($30-50) or ClassPass'},
  'RO HEALTH':{name:'Ro Health',avg:94,essential:true,tip:'Health/prescriptions â€” keep'},
  'MEALPAL':{name:'MealPal',avg:53,essential:false,tip:'$53/mo â€” cooking saves more'},
  'CLAUDE.AI SUBSCRIPTION':{name:'Claude AI',avg:32,essential:true,tip:'Your AI backbone â€” essential'},
  'ORENDA PSYCHIATRY':{name:'Orenda Psychiatry',avg:30,essential:true,tip:'Mental health â€” keep'},
  'TIKTOK SHOP':{name:'TikTok Shop',avg:28,essential:false,tip:'11 impulse buys in 6mo â€” $28/mo avg'},
  'ADOBE  *800-833-6687':{name:'Adobe CC (3 subs!)',avg:82,essential:false,tip:'3 Adobe charges/mo totaling ~$82. Do you use all of them? Figma/Photopea/DaVinci are free'},
  'GOOGLE *YouTubePremium':{name:'YouTube Premium',avg:23,essential:false,tip:'$23/mo â€” uBlock Origin is free'},
  'OPENAI *CHATGPT SUBSCR':{name:'ChatGPT Plus',avg:22,essential:false,tip:'You already have Claude â€” save $22/mo'},
  'Spotify USA':{name:'Spotify',avg:12,essential:true,tip:'Essential for a DJ ğŸ§'},
  'APPLE.COM/BILL':{name:'Apple Services',avg:23,essential:true,tip:'iCloud + other Apple subs'},
};
const CAT_COLORS={'Food & Drink':'#ef4444','Shopping':'#f59e0b','Travel':'#3b82f6','Groceries':'#22c55e','Health & Wellness':'#e879f9','Bills & Utilities':'#998eb5','Entertainment':'#22d3ee','Personal':'#fb923c','Education':'#a78bfa','Gas':'#64748b','Professional Services':'#14b8a6','Gifts & Donations':'#f472b6','Home':'#84cc16'};

async function loadSpending(){
  const SB='https://aihworyfcgstwbpzkzoy.supabase.co/rest/v1';
  const KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFpaHdvcnlmY2dzdHdicHprem95Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExMjE0NzEsImV4cCI6MjA4NjY5NzQ3MX0.NrYtMgZ3D5VL-ES6iGXrmg-WEb-fRgU4AHKnLuhcTlE';
  const hdr={apikey:KEY,Authorization:'Bearer '+KEY};
  let all=[], offset=0, batch=1000;
  while(true){
    const r=await fetch(`${SB}/spending?select=*&type=eq.Sale&order=transaction_date.desc&offset=${offset}&limit=${batch}`,{headers:{...hdr,'Range-Unit':'items','Range':`${offset}-${offset+batch-1}`,'Prefer':'count=exact'}});
    const d=await r.json(); all=all.concat(d);
    if(d.length<batch) break; offset+=batch;
  }

  // Group by month
  const byMonth={};
  all.forEach(t=>{
    const m=t.transaction_date.slice(0,7);
    if(!byMonth[m])byMonth[m]={total:0,cats:{},txns:[]};
    const amt=Math.abs(t.amount);
    byMonth[m].total+=amt;
    const c=t.category||'Other';
    byMonth[m].cats[c]=(byMonth[m].cats[c]||0)+amt;
    byMonth[m].txns.push(t);
  });

  const months=Object.keys(byMonth).sort().reverse();
  const fullMonths=months.filter(m=>m>='2025-07'&&m<months[0]);

  // Stats
  const avgSpend=fullMonths.length?fullMonths.reduce((s,m)=>s+byMonth[m].total,0)/fullMonths.length:0;
  const subsTotal=Object.values(SUBS_MAP).reduce((s,v)=>s+v.avg,0);
  const cuttable=Object.values(SUBS_MAP).filter(v=>!v.essential).reduce((s,v)=>s+v.avg,0);
  const topCat=fullMonths.length?Object.entries(fullMonths.reduce((acc,m)=>{Object.entries(byMonth[m].cats).forEach(([c,v])=>{acc[c]=(acc[c]||0)+v});return acc},{})).sort((a,b)=>b[1]-a[1])[0][0]:'â€”';
  const totalAll=all.reduce((s,t)=>s+Math.abs(t.amount),0);

  document.getElementById('spending-stats').innerHTML=`
    ${stat('Monthly Avg (card)','$'+Math.round(avgSpend).toLocaleString(),fullMonths.length+' full months (Julâ€“Jan)')}
    ${stat('+ Rent','$'+RENT.toLocaleString(),'not on card')}
    ${stat('Total Monthly Burn','$'+Math.round(avgSpend+RENT).toLocaleString(),'~$'+Math.round((avgSpend+RENT)*12/1000)+'K/yr')}
    ${stat('Subscriptions','$'+Math.round(subsTotal)+'/mo',Object.keys(SUBS_MAP).length+' recurring')}
    ${stat('Potential Savings','$'+Math.round(cuttable)+'/mo','$'+Math.round(cuttable*12).toLocaleString()+'/yr cuttable')}
    ${stat('Transactions',all.length.toLocaleString(),'analyzed')}
  `;

  // Month selector
  const sel=document.getElementById('spendMonth');
  sel.innerHTML=months.map(m=>`<option value="${m}">${m}</option>`).join('');
  sel.onchange=()=>renderMonth(byMonth[sel.value],sel.value);
  renderMonth(byMonth[months[0]],months[0]);

  // â”€â”€ Trend chart â”€â”€
  const trendMonths=months.slice().reverse().filter(m=>m>='2025-07');
  const ctx2=document.getElementById('spendTrend').getContext('2d');
  if(spendTrendInstance)spendTrendInstance.destroy();
  spendTrendInstance=new Chart(ctx2,{type:'bar',data:{
    labels:trendMonths,
    datasets:[
      {label:'Card Spending',data:trendMonths.map(m=>Math.round(byMonth[m].total)),backgroundColor:'rgba(232,128,240,0.6)',borderRadius:6},
      {label:'Rent ($3K)',data:trendMonths.map(()=>RENT),backgroundColor:'rgba(153,142,181,0.4)',borderRadius:6}
    ]},options:{responsive:true,plugins:{legend:{labels:{color:'#d4c4f0'}},tooltip:{callbacks:{label:c=>'$'+c.raw.toLocaleString()}},annotation:{}},scales:{x:{stacked:true,ticks:{color:'#665c78'},grid:{display:false}},y:{stacked:true,ticks:{color:'#665c78',callback:v=>'$'+(v/1000).toFixed(0)+'K'},grid:{color:'rgba(255,255,255,0.04)'}}}}});

  // â”€â”€ Food deep dive â”€â”€
  const foodTxns=all.filter(t=>(t.category==='Food & Drink'));
  const deliveryKw=['DOORDASH','UBER EATS','GRUBHUB','SEAMLESS','CAVIAR'];
  const coffeeKw=['COFFEE','BLUE BOTTLE','DEVOCION','GRANIERO','STARBUCKS','JOE'];
  const barKw=['BAR','COCKTAIL','BREWERY','BLINKY','ELSEWHERE','BOTTLE SHOPPE','RADEGAST'];
  let delivery=0,coffee=0,bars=0,restaurants=0;
  const foodPlaces={};
  foodTxns.forEach(t=>{
    const d=t.description.toUpperCase(), amt=Math.abs(t.amount);
    if(deliveryKw.some(k=>d.includes(k))) delivery+=amt;
    else if(coffeeKw.some(k=>d.includes(k))) coffee+=amt;
    else if(barKw.some(k=>d.includes(k))) bars+=amt;
    else restaurants+=amt;
    const name=t.description.replace(/\s*(TST\*|SQ \*|DD \*)/,'').trim();
    foodPlaces[name]=(foodPlaces[name]||{total:0,count:0});
    foodPlaces[name].total+=amt; foodPlaces[name].count++;
  });
  const foodTotal=foodTxns.reduce((s,t)=>s+Math.abs(t.amount),0);
  const foodMonthly=fullMonths.length?foodTotal/fullMonths.length:0;
  const topFood=Object.entries(foodPlaces).sort((a,b)=>b[1].total-a[1].total).slice(0,10);
  const bigNights=foodTxns.filter(t=>Math.abs(t.amount)>=200).sort((a,b)=>Math.abs(b.amount)-Math.abs(a.amount)).slice(0,8);

  document.getElementById('spend-food').innerHTML=`
    <div style="display:flex;gap:20px;flex-wrap:wrap;margin-bottom:16px">
      <div style="flex:1;min-width:200px">
        <div style="margin-bottom:8px;color:#998eb5">Breakdown ($${Math.round(foodTotal).toLocaleString()} total, $${Math.round(foodMonthly).toLocaleString()}/mo avg)</div>
        <div class="expense-row"><span>ğŸ½ï¸ Restaurants</span><strong>$${Math.round(restaurants).toLocaleString()}</strong></div>
        <div class="expense-row"><span>ğŸº Bars & Nightlife</span><strong>$${Math.round(bars).toLocaleString()}</strong></div>
        <div class="expense-row"><span>ğŸ›µ Delivery (DoorDash etc)</span><strong>$${Math.round(delivery).toLocaleString()}</strong></div>
        <div class="expense-row"><span>â˜• Coffee</span><strong>$${Math.round(coffee).toLocaleString()}</strong></div>
      </div>
      <div style="flex:1;min-width:200px">
        <div style="margin-bottom:8px;color:#998eb5">Top Spots</div>
        ${topFood.map(([n,v])=>`<div class="expense-row"><span>${n} <span style="color:#665c78">(${v.count}x)</span></span><strong>$${Math.round(v.total).toLocaleString()}</strong></div>`).join('')}
      </div>
    </div>
    ${bigNights.length?`<div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.06)">
      <div style="color:#ef4444;font-weight:600;margin-bottom:8px">ğŸš¨ $200+ Nights Out (${bigNights.length} total = ~$${Math.round(bigNights.reduce((s,t)=>s+Math.abs(t.amount),0)).toLocaleString()})</div>
      ${bigNights.map(t=>`<div class="expense-row"><span>${t.description} <span style="color:#665c78">${t.transaction_date}</span></span><strong style="color:#ef4444">$${Math.abs(t.amount).toFixed(0)}</strong></div>`).join('')}
    </div>`:''}
  `;

  // â”€â”€ Transport â”€â”€
  const uberTxns=all.filter(t=>t.description&&t.description.toUpperCase().includes('UBER'));
  const lyftTxns=all.filter(t=>t.description&&t.description.toUpperCase().includes('LYFT'));
  const mtaTxns=all.filter(t=>t.description&&t.description.toUpperCase().includes('MTA'));
  const uberTotal=uberTxns.reduce((s,t)=>s+Math.abs(t.amount),0);
  const lyftTotal=lyftTxns.reduce((s,t)=>s+Math.abs(t.amount),0);
  const mtaTotal=mtaTxns.reduce((s,t)=>s+Math.abs(t.amount),0);
  const rideByMonth={};
  [...uberTxns,...lyftTxns].forEach(t=>{const m=t.transaction_date.slice(0,7);rideByMonth[m]=(rideByMonth[m]||0)+Math.abs(t.amount)});
  const rideTrend=Object.entries(rideByMonth).sort((a,b)=>a[0].localeCompare(b[0]));

  document.getElementById('spend-transport').innerHTML=`
    <div class="expense-row"><span>ğŸš— Uber</span><strong>$${Math.round(uberTotal).toLocaleString()} <span style="color:#665c78">(${uberTxns.length} trips)</span></strong></div>
    <div class="expense-row"><span>ğŸš— Lyft</span><strong>$${Math.round(lyftTotal).toLocaleString()} <span style="color:#665c78">(${lyftTxns.length} trips)</span></strong></div>
    <div class="expense-row"><span>ğŸš‡ MTA Subway</span><strong>$${Math.round(mtaTotal).toLocaleString()} <span style="color:#665c78">(${mtaTxns.length} swipes)</span></strong></div>
    <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.06);color:#998eb5;font-size:12px">
      <strong>Rideshare trend:</strong><br>
      ${rideTrend.map(([m,v])=>`${m}: $${Math.round(v)}`).join(' â†’ ')}
      ${rideTrend.length>=2&&rideTrend[rideTrend.length-1][1]<rideTrend[rideTrend.length-2][1]?'<br><span style="color:#22c55e">ğŸ“‰ Trending down â€” nice work switching to subway!</span>':''}
    </div>
  `;

  // â”€â”€ Shopping â”€â”€
  const shopTxns=all.filter(t=>t.category==='Shopping');
  const shopMerchants={};
  shopTxns.forEach(t=>{const n=t.description.replace(/\*\S+/,'').trim();shopMerchants[n]=(shopMerchants[n]||{total:0,count:0});shopMerchants[n].total+=Math.abs(t.amount);shopMerchants[n].count++});
  const topShop=Object.entries(shopMerchants).sort((a,b)=>b[1].total-a[1].total).slice(0,8);
  const amazonTxns=shopTxns.filter(t=>t.description.toUpperCase().includes('AMAZON'));
  const tiktokTxns=shopTxns.filter(t=>t.description.toUpperCase().includes('TIKTOK'));

  document.getElementById('spend-shopping').innerHTML=`
    <div style="margin-bottom:8px;color:#998eb5">$${Math.round(shopTxns.reduce((s,t)=>s+Math.abs(t.amount),0)).toLocaleString()} total shopping</div>
    ${topShop.map(([n,v])=>`<div class="expense-row"><span>${n} <span style="color:#665c78">(${v.count}x)</span></span><strong>$${Math.round(v.total).toLocaleString()}</strong></div>`).join('')}
    <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.06);font-size:12px;color:#998eb5">
      ğŸš¨ Amazon: ${amazonTxns.length} orders ($${Math.round(amazonTxns.reduce((s,t)=>s+Math.abs(t.amount),0)).toLocaleString()}) â€” ~${(amazonTxns.length/fullMonths.length).toFixed(0)}/mo<br>
      ğŸš¨ TikTok Shop: ${tiktokTxns.length} impulse buys ($${Math.round(tiktokTxns.reduce((s,t)=>s+Math.abs(t.amount),0)).toLocaleString()})
    </div>
  `;

  // â”€â”€ Top 20 Merchants â”€â”€
  const allMerchants={};
  all.forEach(t=>{const n=t.description;allMerchants[n]=(allMerchants[n]||{total:0,count:0,cat:t.category});allMerchants[n].total+=Math.abs(t.amount);allMerchants[n].count++});
  const top20=Object.entries(allMerchants).sort((a,b)=>b[1].total-a[1].total).slice(0,20);
  document.getElementById('spend-merchants').innerHTML=`
    <div style="display:grid;grid-template-columns:auto 1fr auto auto;gap:4px 16px;align-items:center">
      <div style="color:#665c78;font-weight:600">#</div><div style="color:#665c78;font-weight:600">Merchant</div><div style="color:#665c78;font-weight:600">Visits</div><div style="color:#665c78;font-weight:600;text-align:right">Total</div>
      ${top20.map(([n,v],i)=>`<div style="color:#665c78">${i+1}</div><div>${n}</div><div style="text-align:center">${v.count}</div><div style="text-align:right;font-weight:600">$${Math.round(v.total).toLocaleString()}</div>`).join('')}
    </div>
  `;

  // â”€â”€ Subscriptions â”€â”€
  document.getElementById('spend-subs').innerHTML=Object.values(SUBS_MAP)
    .sort((a,b)=>b.avg-a.avg)
    .map(s=>`<div class="expense-row"><span>${s.essential?'âœ…':'âš ï¸'} ${s.name}</span><strong${s.essential?'':' style="color:#f59e0b"'}>$${s.avg}/mo</strong></div>`)
    .join('')+`<div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.06);font-weight:600;color:#e8e0f0">Total: $${subsTotal}/mo ($${Math.round(subsTotal*12).toLocaleString()}/yr)</div>`;

  // â”€â”€ Savings Plan â”€â”€
  const savings=[
    {action:'Drop ChatGPT (have Claude)',save:22,period:'mo',annual:264},
    {action:'Audit Adobe (3â†’1 sub)',save:55,period:'mo',annual:660},
    {action:'Keep rideshare low (subway)',save:400,period:'mo',annual:4800},
    {action:'Cap dining at $1K/mo',save:700,period:'mo',annual:8400},
    {action:'Limit $200+ nights to 1/mo',save:400,period:'mo',annual:4800},
    {action:'Stop TikTok Shop',save:50,period:'mo',annual:600},
    {action:'Amazon 48hr rule (cut 30%)',save:150,period:'mo',annual:1800},
    {action:'Cancel MealPal',save:53,period:'mo',annual:636},
  ];
  const totalSave=savings.reduce((s,v)=>s+v.save,0);
  document.getElementById('spend-tips').innerHTML=`
    <div style="margin-bottom:12px"><strong style="color:#22c55e">ğŸ’° Potential savings: ~$${totalSave.toLocaleString()}/mo ($${Math.round(totalSave*12).toLocaleString()}/yr)</strong></div>
    ${savings.map(s=>`<div style="margin-bottom:6px">â€¢ <strong>${s.action}</strong> â†’ <span style="color:#22c55e">-$${s.save}/${s.period}</span> <span style="color:#665c78">($${s.annual.toLocaleString()}/yr)</span></div>`).join('')}
  `;

  // â”€â”€ Budget comparison â”€â”€
  const budgetRows=[
    {cat:'Rent',current:3000,target:3000},
    {cat:'Food & Drink',current:1700,target:1000},
    {cat:'Groceries',current:379,target:400},
    {cat:'Shopping',current:1370,target:600},
    {cat:'Travel',current:1276,target:500},
    {cat:'Rideshare',current:420,target:100},
    {cat:'Health & Wellness',current:447,target:350},
    {cat:'Entertainment',current:266,target:200},
    {cat:'Subscriptions',current:Math.round(subsTotal),target:200},
    {cat:'Other',current:615,target:400},
  ];
  const currentTotal=budgetRows.reduce((s,r)=>s+r.current,0);
  const targetTotal=budgetRows.reduce((s,r)=>s+r.target,0);
  document.getElementById('spend-budget').innerHTML=`
    <div style="display:grid;grid-template-columns:1fr auto auto auto;gap:6px 20px;align-items:center">
      <div style="color:#665c78;font-weight:600">Category</div><div style="color:#665c78;font-weight:600;text-align:right">Current</div><div style="color:#665c78;font-weight:600;text-align:right">Target</div><div style="color:#665c78;font-weight:600;text-align:right">Saved</div>
      ${budgetRows.map(r=>{const diff=r.current-r.target;return `<div>${r.cat}</div><div style="text-align:right">$${r.current.toLocaleString()}</div><div style="text-align:right;color:#22c55e">$${r.target.toLocaleString()}</div><div style="text-align:right;color:${diff>0?'#22c55e':'#665c78'}">${diff>0?'-$'+diff.toLocaleString():'â€”'}</div>`}).join('')}
      <div style="font-weight:700;padding-top:8px;border-top:1px solid rgba(255,255,255,0.1)">TOTAL</div>
      <div style="font-weight:700;text-align:right;padding-top:8px;border-top:1px solid rgba(255,255,255,0.1)">$${currentTotal.toLocaleString()}</div>
      <div style="font-weight:700;text-align:right;padding-top:8px;border-top:1px solid rgba(255,255,255,0.1);color:#22c55e">$${targetTotal.toLocaleString()}</div>
      <div style="font-weight:700;text-align:right;padding-top:8px;border-top:1px solid rgba(255,255,255,0.1);color:#22c55e">-$${(currentTotal-targetTotal).toLocaleString()}/mo</div>
    </div>
  `;

  // â”€â”€ Weekend vs Weekday â”€â”€
  let wkday={total:0,count:0},wkend={total:0,count:0};
  all.forEach(t=>{
    const d=new Date(t.transaction_date+'T12:00:00').getDay();
    const amt=Math.abs(t.amount);
    if(d===0||d===6){wkend.total+=amt;wkend.count++}else{wkday.total+=amt;wkday.count++}
  });
  const numDays=Math.ceil((new Date(all[0].transaction_date)-new Date(all[all.length-1].transaction_date))/(86400000));
  const wkdayDays=Math.round(numDays*5/7), wkendDays=numDays-wkdayDays;
  document.getElementById('spend-daytype').innerHTML=`
    <div style="display:flex;gap:40px;flex-wrap:wrap">
      <div>
        <div style="font-size:24px;font-weight:700;color:#e8e0f0">$${Math.round(wkday.total/wkdayDays)}/day</div>
        <div style="color:#665c78">Weekdays (${wkday.count} txns)</div>
      </div>
      <div>
        <div style="font-size:24px;font-weight:700;color:#f59e0b">$${Math.round(wkend.total/wkendDays)}/day</div>
        <div style="color:#665c78">Weekends (${wkend.count} txns)</div>
      </div>
      <div>
        <div style="font-size:24px;font-weight:700;color:#ef4444">+${Math.round((wkend.total/wkendDays)/(wkday.total/wkdayDays)*100-100)}%</div>
        <div style="color:#665c78">Weekend premium</div>
      </div>
    </div>
    <div style="margin-top:12px;color:#998eb5;font-size:12px">Weekends cost more per day â€” restaurants, bars, and rideshares spike Friâ€“Sun</div>
  `;
}

function renderMonth(data,label){
  if(!data)return;
  const cats=Object.entries(data.cats).sort((a,b)=>b[1]-a[1]);
  const ctx=document.getElementById('spendChart').getContext('2d');
  if(spendChartInstance)spendChartInstance.destroy();
  spendChartInstance=new Chart(ctx,{type:'doughnut',data:{
    labels:cats.map(c=>c[0]),
    datasets:[{data:cats.map(c=>Math.round(c[1])),backgroundColor:cats.map(c=>CAT_COLORS[c[0]]||'#665c78'),borderWidth:0}]
  },options:{responsive:true,cutout:'60%',plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>'$'+c.raw.toLocaleString()+' ('+Math.round(c.raw/data.total*100)+'%)'}}}}});

  document.getElementById('spend-cats').innerHTML=`
    <div style="margin-bottom:12px;font-size:16px;font-weight:700;color:#e8e0f0">$${Math.round(data.total).toLocaleString()} <span style="font-size:12px;color:#665c78;font-weight:400">(card only, +$3K rent)</span></div>
    ${cats.map(([c,v])=>`<div class="expense-row"><span><span style="color:${CAT_COLORS[c]||'#665c78'}">â—</span> ${c}</span><strong>$${Math.round(v).toLocaleString()} <span style="color:#665c78;font-weight:400">${Math.round(v/data.total*100)}%</span></strong></div>`).join('')}
  `;
}
</script>
</body>
</html>